<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Nest - Blog(issues)</title><meta property="og:type" content="artical"/><meta property="og:title" content="Nest"/><meta property="og:image" content="
        https://og-image.vercel.app/Nest.png?theme=light&amp;md=1&amp;fontSize=100px&amp;images=https%3A%2F%2Fassets.vercel.com%2Fimage%2Fupload%2Ffront%2Fassets%2Fdesign%2Fvercel-triangle-black.svg
      "/><meta property="article:published_time" content="2022-04-18T04:47:31Z"/><meta property="article:author" content="xiaotiandada"/><meta name="twitter:card" content="Nest"/><meta name="twitter:title" content="Nest"/><meta name="twitter:image" content="
        https://og-image.vercel.app/Nest.png?theme=light&amp;md=1&amp;fontSize=100px&amp;images=https%3A%2F%2Fassets.vercel.com%2Fimage%2Fupload%2Ffront%2Fassets%2Fdesign%2Fvercel-triangle-black.svg
      "/><meta name="next-head-count" content="4"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin=""/><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Serif:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&amp;display=swap" rel="stylesheet"/><link rel="preload" href="/_next/static/css/b78bfc7021c6877d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b78bfc7021c6877d.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-cb7634a8b6194820.js" defer=""></script><script src="/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="/_next/static/chunks/main-2190439a97dca295.js" defer=""></script><script src="/_next/static/chunks/pages/_app-2aac380799256b7f.js" defer=""></script><script src="/_next/static/chunks/pages/%5B...path%5D-e0b96643230aac68.js" defer=""></script><script src="/_next/static/YPEk3V-eoVeml18YoUSCM/_buildManifest.js" defer=""></script><script src="/_next/static/YPEk3V-eoVeml18YoUSCM/_ssgManifest.js" defer=""></script><script src="/_next/static/YPEk3V-eoVeml18YoUSCM/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div><div class="container mx-auto mt-24 max-w-2xl px-4 sm:px-0"><div><div class="flex my-8 font-bold"><a href="/">Blog(issues)</a></div></div><div class="mb-8"><div class="text-3xl font-medium">Nest</div><div class="flex mt-4 items-center gap-2"><img class="w-8 h-8 rounded-full" src="https://avatars.githubusercontent.com/u/24250627?u=51a93e07957381123eb9fbdd6407de36033b578d&amp;v=4"/><a target="_blank" href="https://github.com/xiaotiandada">xiaotiandada</a><a class="underline text-sm" target="_blank" href="https://github.com/xiaotiandada/blog/issues/99">View on GitHub</a></div><div class="my-8"><div class="flex gap-4 flex-wrap"></div></div></div><div class="post-body"><h2 id="class-validator">class-validator</h2>
<ul>
<li><a href="https://juejin.cn/post/7083505497021612068">class-validator 校验器的使用</a></li>
</ul>
<h2 id="validationpipe">ValidationPipe</h2>
<blockquote>
<p><a href="https://docs.nestjs.com/techniques/validation#stripping-properties">https://docs.nestjs.com/techniques/validation#stripping-properties</a>
<a href="http://static.kancloud.cn/juukee/nestjs/2675355">http://static.kancloud.cn/juukee/nestjs/2675355</a>
<a href="https://juejin.cn/post/7064595876680826910">https://juejin.cn/post/7064595876680826910</a></p>
</blockquote>
<h3 id="transform">transform</h3>
<pre class="language-ts"><code class="language-ts">app.useGlobalPipes(
    new ValidationPipe({
      transform: true,
    }),
);</code></pre><pre class="language-ts"><code class="language-ts">@Get(':id')
findOne(@Param('id') id: number) {
 console.log(typeof id === 'number'); // true
 return 'This action returns a user';
}</code></pre><p> id 会自动从 string 转换成 number</p>
<h3 id="whitelist">whitelist</h3>
<pre class="language-ts"><code class="language-ts">app.useGlobalPipes(
    new ValidationPipe({
      whitelist: true,
    }),
);</code></pre><p>true 时，自动删除非白名单属性(在验证类中没有任何修饰符的属性)。</p>
<pre class="language-ts"><code class="language-ts">// Bad
// 所有参数都将被过滤
export class CreateCatDto {
  public name: string;

  public age: number;
  
  public breed: string;
}


// Good
import { IsNumber, IsString } from 'class-validator';

export class CreateCatDto {
  @IsString()
  public name: string;

  @IsNumber()
  public age: number;

  @IsString()
  public breed: string;
}</code></pre><h3 id="typeorm">typeorm</h3>
<pre class="language-bash"><code class="language-bash">    "typeorm": "^0.3.6",
    "typeorm": "0.2.45",</code></pre><p>0.3.x 按照文档无法工作
0.2.x 按照文档正常工作</p>
</div><hr class="my-12"/><div class="font-sans"><div class="mb-12"><a target="_blank" href="https://github.com/xiaotiandada/blog/issues/99" class="font-medium border border-gray-700 hover:bg-gray-700 hover:text-gray-100 transition-all text-gray-700 text-sm rounded px-4 py-2">Add comment</a></div></div><div class="my-12"><div class="text-sm">Powered by <a class="underline" target="_blank" href="https://github.com/djyde/sairin">Sairin</a></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"id":"I_kwDOD_pKSM5H7CXe","url":"https://github.com/xiaotiandada/blog/issues/99","title":"Nest","updatedAt":"2022-06-07T13:55:53Z","createdAt":"2022-04-18T04:47:31Z","body":"## class-validator\r\n- [class-validator 校验器的使用](https://juejin.cn/post/7083505497021612068)\r\n\r\n## ValidationPipe\r\n\u003e https://docs.nestjs.com/techniques/validation#stripping-properties\r\n\u003e http://static.kancloud.cn/juukee/nestjs/2675355\r\n\u003e https://juejin.cn/post/7064595876680826910\r\n### transform\r\n```ts\r\napp.useGlobalPipes(\r\n    new ValidationPipe({\r\n      transform: true,\r\n    }),\r\n);\r\n ```\r\n \r\n ```ts\r\n@Get(':id')\r\nfindOne(@Param('id') id: number) {\r\n  console.log(typeof id === 'number'); // true\r\n  return 'This action returns a user';\r\n}\r\n```\r\n \r\n id 会自动从 string 转换成 number\r\n\r\n### whitelist\r\n```ts\r\napp.useGlobalPipes(\r\n    new ValidationPipe({\r\n      whitelist: true,\r\n    }),\r\n);\r\n ```\r\n \r\ntrue 时，自动删除非白名单属性(在验证类中没有任何修饰符的属性)。\r\n\r\n```ts\r\n// Bad\r\n// 所有参数都将被过滤\r\nexport class CreateCatDto {\r\n  public name: string;\r\n\r\n  public age: number;\r\n  \r\n  public breed: string;\r\n}\r\n\r\n\r\n// Good\r\nimport { IsNumber, IsString } from 'class-validator';\r\n\r\nexport class CreateCatDto {\r\n  @IsString()\r\n  public name: string;\r\n\r\n  @IsNumber()\r\n  public age: number;\r\n\r\n  @IsString()\r\n  public breed: string;\r\n}\r\n```\r\n\r\n\r\n### typeorm\r\n\r\n```bash\r\n    \"typeorm\": \"^0.3.6\",\r\n    \"typeorm\": \"0.2.45\",\r\n```\r\n\r\n0.3.x 按照文档无法工作\r\n0.2.x 按照文档正常工作\r\n","comments":{"nodes":[]},"reactionGroups":[{"content":"THUMBS_UP","reactors":{"totalCount":0}},{"content":"THUMBS_DOWN","reactors":{"totalCount":0}},{"content":"LAUGH","reactors":{"totalCount":0}},{"content":"HOORAY","reactors":{"totalCount":0}},{"content":"CONFUSED","reactors":{"totalCount":0}},{"content":"HEART","reactors":{"totalCount":0}},{"content":"ROCKET","reactors":{"totalCount":0}},{"content":"EYES","reactors":{"totalCount":0}}],"author":{"login":"xiaotiandada","url":"https://github.com/xiaotiandada","avatarUrl":"https://avatars.githubusercontent.com/u/24250627?u=51a93e07957381123eb9fbdd6407de36033b578d\u0026v=4"},"html":"\u003ch2 id=\"class-validator\"\u003eclass-validator\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://juejin.cn/post/7083505497021612068\"\u003eclass-validator 校验器的使用\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"validationpipe\"\u003eValidationPipe\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://docs.nestjs.com/techniques/validation#stripping-properties\"\u003ehttps://docs.nestjs.com/techniques/validation#stripping-properties\u003c/a\u003e\n\u003ca href=\"http://static.kancloud.cn/juukee/nestjs/2675355\"\u003ehttp://static.kancloud.cn/juukee/nestjs/2675355\u003c/a\u003e\n\u003ca href=\"https://juejin.cn/post/7064595876680826910\"\u003ehttps://juejin.cn/post/7064595876680826910\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 id=\"transform\"\u003etransform\u003c/h3\u003e\n\u003cpre class=\"language-ts\"\u003e\u003ccode class=\"language-ts\"\u003eapp.useGlobalPipes(\n    new ValidationPipe({\n      transform: true,\n    }),\n);\u003c/code\u003e\u003c/pre\u003e\u003cpre class=\"language-ts\"\u003e\u003ccode class=\"language-ts\"\u003e@Get(':id')\nfindOne(@Param('id') id: number) {\n console.log(typeof id === 'number'); // true\n return 'This action returns a user';\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e id 会自动从 string 转换成 number\u003c/p\u003e\n\u003ch3 id=\"whitelist\"\u003ewhitelist\u003c/h3\u003e\n\u003cpre class=\"language-ts\"\u003e\u003ccode class=\"language-ts\"\u003eapp.useGlobalPipes(\n    new ValidationPipe({\n      whitelist: true,\n    }),\n);\u003c/code\u003e\u003c/pre\u003e\u003cp\u003etrue 时，自动删除非白名单属性(在验证类中没有任何修饰符的属性)。\u003c/p\u003e\n\u003cpre class=\"language-ts\"\u003e\u003ccode class=\"language-ts\"\u003e// Bad\n// 所有参数都将被过滤\nexport class CreateCatDto {\n  public name: string;\n\n  public age: number;\n  \n  public breed: string;\n}\n\n\n// Good\nimport { IsNumber, IsString } from 'class-validator';\n\nexport class CreateCatDto {\n  @IsString()\n  public name: string;\n\n  @IsNumber()\n  public age: number;\n\n  @IsString()\n  public breed: string;\n}\u003c/code\u003e\u003c/pre\u003e\u003ch3 id=\"typeorm\"\u003etypeorm\u003c/h3\u003e\n\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003e    \"typeorm\": \"^0.3.6\",\n    \"typeorm\": \"0.2.45\",\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e0.3.x 按照文档无法工作\n0.2.x 按照文档正常工作\u003c/p\u003e\n","attributes":{}},"themeConfig":{"title":"Blog(issues)","links":[{"title":"GitHub","url":"https://github.com/xiaotiandada/blog"},{"title":"Twitter","url":"https://twitter.com/XiaoTianIsMe"}]}},"__N_SSG":true},"page":"/[...path]","query":{"path":["I_kwDOD_pKSM5H7CXe"]},"buildId":"YPEk3V-eoVeml18YoUSCM","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>