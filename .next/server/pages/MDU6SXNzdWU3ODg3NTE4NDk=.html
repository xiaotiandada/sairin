<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>bilibili banner动画研究【一】 - Blog(issues)</title><meta property="og:type" content="artical"/><meta property="og:title" content="bilibili banner动画研究【一】"/><meta property="og:image" content="
        https://og-image.vercel.app/bilibili banner动画研究【一】.png?theme=light&amp;md=1&amp;fontSize=100px&amp;images=https%3A%2F%2Fassets.vercel.com%2Fimage%2Fupload%2Ffront%2Fassets%2Fdesign%2Fvercel-triangle-black.svg
      "/><meta property="article:published_time" content="2021-01-19T06:40:19Z"/><meta property="article:author" content="xiaotiandada"/><meta name="twitter:card" content="bilibili banner动画研究【一】"/><meta name="twitter:title" content="bilibili banner动画研究【一】"/><meta name="twitter:image" content="
        https://og-image.vercel.app/bilibili banner动画研究【一】.png?theme=light&amp;md=1&amp;fontSize=100px&amp;images=https%3A%2F%2Fassets.vercel.com%2Fimage%2Fupload%2Ffront%2Fassets%2Fdesign%2Fvercel-triangle-black.svg
      "/><meta name="next-head-count" content="4"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin=""/><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Serif:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&amp;display=swap" rel="stylesheet"/><link rel="preload" href="/_next/static/css/b78bfc7021c6877d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b78bfc7021c6877d.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-cb7634a8b6194820.js" defer=""></script><script src="/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="/_next/static/chunks/main-2190439a97dca295.js" defer=""></script><script src="/_next/static/chunks/pages/_app-2aac380799256b7f.js" defer=""></script><script src="/_next/static/chunks/pages/%5B...path%5D-e0b96643230aac68.js" defer=""></script><script src="/_next/static/YPEk3V-eoVeml18YoUSCM/_buildManifest.js" defer=""></script><script src="/_next/static/YPEk3V-eoVeml18YoUSCM/_ssgManifest.js" defer=""></script><script src="/_next/static/YPEk3V-eoVeml18YoUSCM/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div><div class="container mx-auto mt-24 max-w-2xl px-4 sm:px-0"><div><div class="flex my-8 font-bold"><a href="/">Blog(issues)</a></div></div><div class="mb-8"><div class="text-3xl font-medium">bilibili banner动画研究【一】</div><div class="flex mt-4 items-center gap-2"><img class="w-8 h-8 rounded-full" src="https://avatars.githubusercontent.com/u/24250627?u=51a93e07957381123eb9fbdd6407de36033b578d&amp;v=4"/><a target="_blank" href="https://github.com/xiaotiandada">xiaotiandada</a><a class="underline text-sm" target="_blank" href="https://github.com/xiaotiandada/blog/issues/61">View on GitHub</a></div><div class="my-8"><div class="flex gap-4 flex-wrap"></div></div></div><div class="post-body"><p> 2020-11-16 21:52:56</p>
<p><img src="https://i.imgur.com/2BWZJjY.jpg?1" alt="动画效果"></p>
<p><a href="https://www.bilibili.com/">https://www.bilibili.com/</a> 后面可能会被更新掉</p>
<blockquote>
<p> 为什么叫一？ 说不能还有别的好玩的动画学习！</p>
</blockquote>
<!-- more -->

<iframe src="https://codesandbox.io/embed/bilibili-bannner-w49d7?fontsize=14&hidenavigation=1&theme=dark&view=preview"
     style="width:100%; height:200px; border:0; border-radius: 4px; overflow:hidden;"
     title="bilibili bannner"
     allow="accelerometer; ambient-light-sensor; camera; encrypted-media; geolocation; gyroscope; hid; microphone; midi; payment; usb; vr; xr-spatial-tracking"
     sandbox="allow-forms allow-modals allow-popups allow-presentation allow-same-origin allow-scripts"
   ></iframe>

<p>主要两个组件完成，代码我也是复制b站大佬的🍑 然后自己理解理解思路</p>
<h3 id="bannervue">Banner.vue</h3>
<pre class="language-javascript"><code class="language-javascript">  <span class="token literal-property property">computed</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">locs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token comment">//...</span>
        <span class="token literal-property property">pic</span><span class="token operator">:</span>
          <span class="token string">"http://i0.hdslb.com/bfs/archive/0b7eef054547750e6bfeff6f36c83e83d2a058fb.png"</span><span class="token punctuation">,</span>
        <span class="token literal-property property">litpic</span><span class="token operator">:</span>
          <span class="token string">"http://i0.hdslb.com/bfs/archive/622017dd4b0140432962d3ce0c6db99d77d2e937.png"</span><span class="token punctuation">,</span>
                <span class="token comment">//...</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">bannerImg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>locs <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>locs<span class="token punctuation">.</span>pic<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">logoImg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>locs <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>locs<span class="token punctuation">.</span>litpic<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre><p>返回一张静止的页面，在没有加载完成或者不支持的时候显示</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 解析数据 提前定义好的具体看代码</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>layerConfig <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'[...]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>解析banner数据</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 只有在启用了动画banner的配置，且浏览器支持css filter时才加载动画banner的图片资源</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>animatedBannerSupport <span class="token operator">=</span>
  <span class="token keyword">typeof</span> <span class="token constant">CSS</span> <span class="token operator">!==</span> <span class="token string">"undefined"</span> <span class="token operator">&amp;&amp;</span>
  <span class="token constant">CSS</span><span class="token punctuation">.</span>supports <span class="token operator">&amp;&amp;</span>
  <span class="token constant">CSS</span><span class="token punctuation">.</span><span class="token function">supports</span><span class="token punctuation">(</span><span class="token string">"filter: blur(1px)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>查看是否支持一些需要的条件</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 根据每帧时长计算循环时间</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>layerConfig<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  v<span class="token punctuation">.</span>loopTime <span class="token operator">=</span> v<span class="token punctuation">.</span>images<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">p<span class="token punctuation">,</span> c</span><span class="token punctuation">)</span> <span class="token operator">=></span> p <span class="token operator">+</span> <span class="token punctuation">(</span>c<span class="token punctuation">.</span>duration <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>统计所有Time 利用 Reduce 累计</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token comment">// 加载所有图片资源</span>
  <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>layerConfig<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"v"</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>
        v<span class="token punctuation">.</span>images<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">i<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> img <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"img"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          img<span class="token punctuation">.</span>src <span class="token operator">=</span> i<span class="token punctuation">.</span>src<span class="token punctuation">;</span>
          <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>img<span class="token punctuation">.</span>onload <span class="token operator">=</span> resolve<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          v<span class="token punctuation">.</span>images<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>img <span class="token operator">=</span> img<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"this.layerConfig"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>layerConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 切换为动画banner</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>animatedBannerLoaded <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"load animated banner images error"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>利用Promise加载所有图片资源，两个Promise是因为images里面也是一个数组</p>
<p>可以用这种方法提前加载图片 这样切换的时候就不会很卡顿 嗯 学习了！</p>
<h3 id="animatedbanner">AnimatedBanner</h3>
<pre class="language-javascript"><code class="language-javascript"><span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">layerConfig</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> Array<span class="token punctuation">,</span>
      <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre><p>接收父组件处理好的数组数据</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> layerConfig <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>layerConfig<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>layerConfig<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> container <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">[</span><span class="token string">"container"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> containerHeight <span class="token operator">=</span> container<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span>
<span class="token keyword">let</span> containerWidth <span class="token operator">=</span> container<span class="token punctuation">.</span>clientWidth<span class="token punctuation">;</span>
<span class="token keyword">let</span> containerScale <span class="token operator">=</span> containerHeight <span class="token operator">/</span> <span class="token number">155</span><span class="token punctuation">;</span>

<span class="token comment">// 加载图片资源移动到组件外部， 这里只设置图片宽高</span>
layerConfig<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  v<span class="token punctuation">.</span>images<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">i<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> img <span class="token operator">=</span> v<span class="token punctuation">.</span>images<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>img<span class="token punctuation">;</span>
    img<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>height <span class="token operator">=</span> img<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
    img<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>width <span class="token operator">=</span> img<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
    img<span class="token punctuation">.</span>height <span class="token operator">=</span>
      img<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>height <span class="token operator">*</span> containerScale <span class="token operator">*</span> <span class="token punctuation">(</span>v<span class="token punctuation">.</span>initial<span class="token punctuation">.</span>scale <span class="token operator">||</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    img<span class="token punctuation">.</span>width <span class="token operator">=</span> img<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>width <span class="token operator">*</span> containerScale <span class="token operator">*</span> <span class="token punctuation">(</span>v<span class="token punctuation">.</span>initial<span class="token punctuation">.</span>scale <span class="token operator">||</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>如果没有调用$emit告诉父组件显示静态图片</p>
<p>获取容器和宽高缩放等属性，并且设置父组件获取图片的宽高等属性 并且根据缩放比例计算</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 初始化图层</span>
<span class="token keyword">const</span> layers <span class="token operator">=</span> layerConfig<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> layer <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  layer<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"layer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  container<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>layer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> layer<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>初始化图层到container</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 初始状态</span>
<span class="token keyword">const</span> <span class="token function-variable function">iaf</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    layers<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">layer<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token comment">// console.log("layer log", i, layer);</span>
      <span class="token keyword">const</span> v <span class="token operator">=</span> layerConfig<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> a <span class="token operator">=</span> layer<span class="token punctuation">.</span>firstChild<span class="token punctuation">;</span>
      <span class="token comment">// console.log("a", a);</span>
      <span class="token keyword">let</span> rotateStr <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> translateStr <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>v<span class="token punctuation">.</span>initial<span class="token punctuation">.</span>rotate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        rotateStr <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">rotate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>v<span class="token punctuation">.</span>initial<span class="token punctuation">.</span>rotate<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">deg)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>v<span class="token punctuation">.</span>initial<span class="token punctuation">.</span>translate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> base <span class="token operator">=</span> v<span class="token punctuation">.</span>initial<span class="token punctuation">.</span>translate <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        translateStr <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>base<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>base<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      a<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transform <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>translateStr<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>rotateStr<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>v<span class="token punctuation">.</span>initial<span class="token punctuation">.</span>blur<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        a<span class="token punctuation">.</span>style<span class="token punctuation">.</span>filter <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">blur(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>initial<span class="token punctuation">.</span>blur<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 切换下一帧的方法</span>
<span class="token keyword">const</span> <span class="token function-variable function">changeToNextFrame</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">layer<span class="token punctuation">,</span> images<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> next <span class="token operator">=</span> i <span class="token operator">===</span> images<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    layer<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>layer<span class="token punctuation">.</span>firstChild<span class="token punctuation">)</span><span class="token punctuation">;</span>
    layer<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>images<span class="token punctuation">[</span>next<span class="token punctuation">]</span><span class="token punctuation">.</span>img<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">changeToNextFrame</span><span class="token punctuation">(</span>layer<span class="token punctuation">,</span> images<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>af<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> images<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>duration<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 初始化图层内图片和帧动画</span>
layerConfig<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">v<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> a <span class="token operator">=</span> v<span class="token punctuation">.</span>images<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>img<span class="token punctuation">;</span>
  layers<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>iaf<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>v<span class="token punctuation">.</span>images<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> v<span class="token punctuation">.</span>loopTime <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">changeToNextFrame</span><span class="token punctuation">(</span>layers<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> v<span class="token punctuation">.</span>images<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>初始化图层图片和一些默认样式并且开始帧动画</p>
<p>利用定时器loop toggle img 删除第一个元素然后添加下一帧图片然后再调用自己</p>
<pre class="language-javascript"><code class="language-javascript">document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"mouseleave"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleMouseLeave<span class="token punctuation">)</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"mousemove"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleMouseMove<span class="token punctuation">)</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"resize"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleResize<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">beforeDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  document<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">"mouseleave"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleMouseLeave<span class="token punctuation">)</span><span class="token punctuation">;</span>
  window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">"mousemove"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleMouseMove<span class="token punctuation">)</span><span class="token punctuation">;</span>
  window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">"resize"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleResize<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre><p>监听一些事件</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">handleMouseMove</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> offsetY <span class="token operator">=</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>scrollTop <span class="token operator">+</span> e<span class="token punctuation">.</span>clientY<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"offsetY"</span><span class="token punctuation">,</span> offsetY<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>offsetY <span class="token operator">&lt;</span> containerHeight<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>entered<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      entered <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      enterX <span class="token operator">=</span> e<span class="token punctuation">.</span>clientX<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    displace <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>clientX <span class="token operator">-</span> enterX<span class="token punctuation">)</span> <span class="token operator">/</span> containerWidth<span class="token punctuation">;</span>
    <span class="token function">cancelAnimationFrame</span><span class="token punctuation">(</span>raf<span class="token punctuation">)</span><span class="token punctuation">;</span>
    raf <span class="token operator">=</span> <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>af<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>entered<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      entered <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token function">handleLeave</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>鼠标经过容器执行af 先取消再继续，不在容器内调用 handleLeave</p>
<pre class="language-javascript"><code class="language-javascript">enterX <span class="token operator">=</span> e<span class="token punctuation">.</span>clientX<span class="token punctuation">;</span>
displace <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>clientX <span class="token operator">-</span> enterX<span class="token punctuation">)</span> <span class="token operator">/</span> containerWidth<span class="token punctuation">;</span></code></pre><p>这两个的含义其实我还没太理解 后续需要用 displace 参与计算 应该就是用来判断往左还是右边的</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 根据鼠标位置改变状态</span>
<span class="token keyword">const</span> <span class="token function-variable function">af</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">t</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    layers<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">layer<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> v <span class="token operator">=</span> layerConfig<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> a <span class="token operator">=</span> layer<span class="token punctuation">.</span>firstChild<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>v<span class="token punctuation">.</span>offset <span class="token operator">||</span> <span class="token operator">!</span>a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">const</span> baseRotate <span class="token operator">=</span> v<span class="token punctuation">.</span>initial<span class="token punctuation">.</span>rotate <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> baseTranslate <span class="token operator">=</span> v<span class="token punctuation">.</span>initial<span class="token punctuation">.</span>trannslate <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> scaleStr <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> rotateStr <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">rotate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>v<span class="token punctuation">.</span>initial<span class="token punctuation">.</span>rotate <span class="token operator">||</span> <span class="token number">0</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">deg)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> translateStr <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>baseTranslate<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>baseTranslate<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
        <span class="token string">"rotateStr translateStr"</span><span class="token punctuation">,</span>
        rotateStr<span class="token punctuation">,</span>
        translateStr<span class="token punctuation">,</span>
        v<span class="token punctuation">.</span>offset
      <span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>v<span class="token punctuation">.</span>offset<span class="token punctuation">.</span>scale<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> itp <span class="token operator">=</span>
              v<span class="token punctuation">.</span>offsetCurve <span class="token operator">&amp;&amp;</span> v<span class="token punctuation">.</span>offsetCurve<span class="token punctuation">.</span>scale
        <span class="token operator">?</span> <span class="token function">curveParameterToFunc</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>offsetCurve<span class="token punctuation">.</span>scale<span class="token punctuation">)</span>
        <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token operator">=></span> x<span class="token punctuation">;</span>
        <span class="token keyword">const</span> offset <span class="token operator">=</span> v<span class="token punctuation">.</span>offset<span class="token punctuation">.</span>scale <span class="token operator">*</span> <span class="token function">itp</span><span class="token punctuation">(</span>displace<span class="token punctuation">)</span><span class="token punctuation">;</span>
        scaleStr <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">scale(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token number">1</span> <span class="token operator">+</span> offset<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>v<span class="token punctuation">.</span>offset<span class="token punctuation">.</span>rotate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> itp <span class="token operator">=</span>
              v<span class="token punctuation">.</span>offsetCurve <span class="token operator">&amp;&amp;</span> v<span class="token punctuation">.</span>offsetCurve<span class="token punctuation">.</span>rotate
        <span class="token operator">?</span> <span class="token function">curveParameterToFunc</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>offsetCurve<span class="token punctuation">.</span>rotate<span class="token punctuation">)</span>
        <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token operator">=></span> x<span class="token punctuation">;</span>
        <span class="token keyword">const</span> offset <span class="token operator">=</span> v<span class="token punctuation">.</span>offset<span class="token punctuation">.</span>rotate <span class="token operator">*</span> <span class="token function">itp</span><span class="token punctuation">(</span>displace<span class="token punctuation">)</span><span class="token punctuation">;</span>
        rotateStr <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">rotate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>baseRotate <span class="token operator">+</span> offset<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">deg)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>v<span class="token punctuation">.</span>offset<span class="token punctuation">.</span>translate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> itp <span class="token operator">=</span>
              v<span class="token punctuation">.</span>offsetCurve <span class="token operator">&amp;&amp;</span> v<span class="token punctuation">.</span>offsetCurve<span class="token punctuation">.</span>translate
        <span class="token operator">?</span> <span class="token function">curveParameterToFunc</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>offsetCurve<span class="token punctuation">.</span>translate<span class="token punctuation">)</span>
        <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token operator">=></span> x<span class="token punctuation">;</span>
        <span class="token keyword">const</span> offset <span class="token operator">=</span> v<span class="token punctuation">.</span>offset<span class="token punctuation">.</span>translate<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">itp</span><span class="token punctuation">(</span>displace<span class="token punctuation">)</span> <span class="token operator">*</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> translate <span class="token operator">=</span> baseTranslate<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>
          <span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=></span>
          <span class="token punctuation">(</span>x <span class="token operator">+</span> offset<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> containerScale <span class="token operator">*</span> <span class="token punctuation">(</span>v<span class="token punctuation">.</span>initial<span class="token punctuation">.</span>scale <span class="token operator">||</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        translateStr <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>translate<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>translate<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      a<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transform <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>scaleStr<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>translateStr<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>rotateStr<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>v<span class="token punctuation">.</span>offset<span class="token punctuation">.</span>blur<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> itp <span class="token operator">=</span>
              v<span class="token punctuation">.</span>offsetCurve <span class="token operator">&amp;&amp;</span> v<span class="token punctuation">.</span>offsetCurve<span class="token punctuation">.</span>blur
        <span class="token operator">?</span> <span class="token function">curveParameterToFunc</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>offsetCurve<span class="token punctuation">.</span>blur<span class="token punctuation">)</span>
        <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token operator">=></span> x<span class="token punctuation">;</span>
        <span class="token keyword">const</span> blurOffset <span class="token operator">=</span> <span class="token function">itp</span><span class="token punctuation">(</span>displace<span class="token punctuation">)</span> <span class="token operator">*</span> v<span class="token punctuation">.</span>offset<span class="token punctuation">.</span>blur<span class="token punctuation">;</span>
        a<span class="token punctuation">.</span>style<span class="token punctuation">.</span>filter <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">blur(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>
          <span class="token punctuation">(</span>v<span class="token punctuation">.</span>initial<span class="token punctuation">.</span>blur <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> blurOffset
        <span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>关键代码在这里...</p>
<ol>
<li><p>判断有没有元素</p>
</li>
<li><p>获取一些初始的style</p>
</li>
<li><p>然后判断有没有offset scale rotate translate blur 然后执行动画</p>
</li>
<li><p>判断有没有 offset curve 如果有用 cubicBezier 没有就用默认参数</p>
</li>
<li><p>往右边 x2 &gt; x1 / width 正数</p>
<ol>
<li><p>Scale 默认是 1</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> offset <span class="token operator">=</span> v<span class="token punctuation">.</span>offset<span class="token punctuation">.</span>scale <span class="token operator">*</span> <span class="token function">itp</span><span class="token punctuation">(</span>displace<span class="token punctuation">)</span><span class="token punctuation">;</span>
scaleStr <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">scale(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token number">1</span> <span class="token operator">+</span> offset<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></code></pre></li>
<li><p>Rotate 根据上面定义的默认参数然后加上新角度</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> offset <span class="token operator">=</span> v<span class="token punctuation">.</span>offset<span class="token punctuation">.</span>rotate <span class="token operator">*</span> <span class="token function">itp</span><span class="token punctuation">(</span>displace<span class="token punctuation">)</span><span class="token punctuation">;</span>
rotateStr <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">rotate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>baseRotate <span class="token operator">+</span> offset<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">deg)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></code></pre></li>
<li><p>Translate 根据比例计算</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> offset <span class="token operator">=</span> v<span class="token punctuation">.</span>offset<span class="token punctuation">.</span>translate<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">itp</span><span class="token punctuation">(</span>displace<span class="token punctuation">)</span> <span class="token operator">*</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> translate <span class="token operator">=</span> baseTranslate<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=></span>
  <span class="token punctuation">(</span>x <span class="token operator">+</span> offset<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> containerScale <span class="token operator">*</span> <span class="token punctuation">(</span>v<span class="token punctuation">.</span>initial<span class="token punctuation">.</span>scale <span class="token operator">||</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
translateStr <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>translate<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>translate<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></code></pre><p>因为是个arr所以map loop，后面的 * 容器比例 * 初始化scale 应该是适配缩放的比例然后变化位置</p>
<pre class="language-javascript"><code class="language-javascript">a<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transform <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>scaleStr<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>translateStr<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>rotateStr<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></code></pre><p>最后设置属性</p>
</li>
<li><p>blur 初始的blur + 变化后的blur</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> blurOffset <span class="token operator">=</span> <span class="token function">itp</span><span class="token punctuation">(</span>displace<span class="token punctuation">)</span> <span class="token operator">*</span> v<span class="token punctuation">.</span>offset<span class="token punctuation">.</span>blur<span class="token punctuation">;</span>
a<span class="token punctuation">.</span>style<span class="token punctuation">.</span>filter <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">blur(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span>v<span class="token punctuation">.</span>initial<span class="token punctuation">.</span>blur <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> blurOffset
<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></code></pre></li>
</ol>
</li>
</ol>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">handleLeave</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> now <span class="token operator">=</span> performance<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> timeout <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> tempDisplace <span class="token operator">=</span> displace<span class="token punctuation">;</span>
  <span class="token function">cancelAnimationFrame</span><span class="token punctuation">(</span>raf<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">leaveAF</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">t</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token operator">-</span> now <span class="token operator">&lt;</span> timeout<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      displace <span class="token operator">=</span> tempDisplace <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> <span class="token punctuation">(</span>t <span class="token operator">-</span> now<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">af</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>leaveAF<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      displace <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token function">af</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  raf <span class="token operator">=</span> <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>leaveAF<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>鼠标离开后 在200time内displace会逐渐变小或扩大 取决于正数还是负数 超过时间后会设置为 0 然后调用动画恢复默认参数</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">handleResize</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  containerHeight <span class="token operator">=</span> container<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span>
  containerWidth <span class="token operator">=</span> container<span class="token punctuation">.</span>clientWidth<span class="token punctuation">;</span>
  containerScale <span class="token operator">=</span> containerHeight <span class="token operator">/</span> <span class="token number">155</span><span class="token punctuation">;</span>
  layerConfig<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">lc</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    lc<span class="token punctuation">.</span>images<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> img <span class="token operator">=</span> i<span class="token punctuation">.</span>img<span class="token punctuation">;</span>
      img<span class="token punctuation">.</span>height <span class="token operator">=</span>
        img<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>height <span class="token operator">*</span> containerScale <span class="token operator">*</span> <span class="token punctuation">(</span>lc<span class="token punctuation">.</span>initial<span class="token punctuation">.</span>scale <span class="token operator">||</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      img<span class="token punctuation">.</span>width <span class="token operator">=</span>
        img<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>width <span class="token operator">*</span> containerScale <span class="token operator">*</span> <span class="token punctuation">(</span>lc<span class="token punctuation">.</span>initial<span class="token punctuation">.</span>scale <span class="token operator">||</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">cancelAnimationFrame</span><span class="token punctuation">(</span>raf<span class="token punctuation">)</span><span class="token punctuation">;</span>
  raf <span class="token operator">=</span> <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">t</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">af</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p> 设置容器的样式参数然后取消动画再开始动画赋值给raf</p>
</div><hr class="my-12"/><div class="font-sans"><div class="mb-12"><a target="_blank" href="https://github.com/xiaotiandada/blog/issues/61" class="font-medium border border-gray-700 hover:bg-gray-700 hover:text-gray-100 transition-all text-gray-700 text-sm rounded px-4 py-2">Add comment</a></div></div><div class="my-12"><div class="text-sm">Powered by <a class="underline" target="_blank" href="https://github.com/djyde/sairin">Sairin</a></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"id":"MDU6SXNzdWU3ODg3NTE4NDk=","url":"https://github.com/xiaotiandada/blog/issues/61","title":"bilibili banner动画研究【一】","updatedAt":"2021-01-19T06:40:19Z","createdAt":"2021-01-19T06:40:19Z","body":" 2020-11-16 21:52:56\r\n\r\n![动画效果](https://i.imgur.com/2BWZJjY.jpg?1)\r\n\r\nhttps://www.bilibili.com/ 后面可能会被更新掉\r\n\r\n\u003e  为什么叫一？ 说不能还有别的好玩的动画学习！\r\n\r\n\u003c!-- more --\u003e\r\n\r\n\u003ciframe src=\"https://codesandbox.io/embed/bilibili-bannner-w49d7?fontsize=14\u0026hidenavigation=1\u0026theme=dark\u0026view=preview\"\r\n     style=\"width:100%; height:200px; border:0; border-radius: 4px; overflow:hidden;\"\r\n     title=\"bilibili bannner\"\r\n     allow=\"accelerometer; ambient-light-sensor; camera; encrypted-media; geolocation; gyroscope; hid; microphone; midi; payment; usb; vr; xr-spatial-tracking\"\r\n     sandbox=\"allow-forms allow-modals allow-popups allow-presentation allow-same-origin allow-scripts\"\r\n   \u003e\u003c/iframe\u003e\r\n\r\n主要两个组件完成，代码我也是复制b站大佬的🍑 然后自己理解理解思路\r\n\r\n### Banner.vue\r\n\r\n```javascript\r\n  computed: {\r\n    locs() {\r\n      return {\r\n    \t\t//...\r\n        pic:\r\n          \"http://i0.hdslb.com/bfs/archive/0b7eef054547750e6bfeff6f36c83e83d2a058fb.png\",\r\n        litpic:\r\n          \"http://i0.hdslb.com/bfs/archive/622017dd4b0140432962d3ce0c6db99d77d2e937.png\",\r\n\t\t\t\t//...\r\n      };\r\n    },\r\n    bannerImg() {\r\n      return (this.locs \u0026\u0026 this.locs.pic).trim();\r\n    },\r\n    logoImg() {\r\n      return (this.locs \u0026\u0026 this.locs.litpic).trim();\r\n    },\r\n  },\r\n```\r\n\r\n返回一张静止的页面，在没有加载完成或者不支持的时候显示\r\n\r\n```javascript\r\n// 解析数据 提前定义好的具体看代码\r\nthis.layerConfig = JSON.parse('[...]');\r\n```\r\n\r\n解析banner数据\r\n\r\n```javascript\r\n// 只有在启用了动画banner的配置，且浏览器支持css filter时才加载动画banner的图片资源\r\nthis.animatedBannerSupport =\r\n  typeof CSS !== \"undefined\" \u0026\u0026\r\n  CSS.supports \u0026\u0026\r\n  CSS.supports(\"filter: blur(1px)\");\r\n```\r\n\r\n查看是否支持一些需要的条件\r\n\r\n```javascript\r\n// 根据每帧时长计算循环时间\r\nthis.layerConfig.map((v) =\u003e {\r\n  v.loopTime = v.images.reduce((p, c) =\u003e p + (c.duration || 0), 0);\r\n});\r\n```\r\n\r\n统计所有Time 利用 Reduce 累计\r\n\r\n```javascript\r\ntry {\r\n  // 加载所有图片资源\r\n  await Promise.all(\r\n    this.layerConfig.map(async (v) =\u003e {\r\n      console.log(\"v\", v);\r\n      return Promise.all(\r\n        v.images.map(async (i, index) =\u003e {\r\n          const img = document.createElement(\"img\");\r\n          img.src = i.src;\r\n          await new Promise((resolve) =\u003e (img.onload = resolve));\r\n          v.images[index].img = img;\r\n        })\r\n      );\r\n    })\r\n  );\r\n  console.log(\"this.layerConfig\", this.layerConfig);\r\n  // 切换为动画banner\r\n  this.animatedBannerLoaded = true;\r\n} catch (e) {\r\n  console.log(\"load animated banner images error\", e);\r\n}\r\n```\r\n\r\n利用Promise加载所有图片资源，两个Promise是因为images里面也是一个数组\r\n\r\n可以用这种方法提前加载图片 这样切换的时候就不会很卡顿 嗯 学习了！\r\n\r\n### AnimatedBanner\r\n\r\n```javascript\r\nprops: {\r\n  layerConfig: {\r\n    type: Array,\r\n      required: true,\r\n  },\r\n},\r\n```\r\n\r\n接收父组件处理好的数组数据\r\n\r\n```javascript\r\nconst layerConfig = this.layerConfig;\r\nif (!layerConfig.length) {\r\n  this.$emit(\"error\");\r\n}\r\n\r\nconst container = this.$refs[\"container\"];\r\nlet containerHeight = container.clientHeight;\r\nlet containerWidth = container.clientWidth;\r\nlet containerScale = containerHeight / 155;\r\n\r\n// 加载图片资源移动到组件外部， 这里只设置图片宽高\r\nlayerConfig.forEach((v) =\u003e {\r\n  v.images.forEach((i, index) =\u003e {\r\n    const img = v.images[index].img;\r\n    img.dataset.height = img.height;\r\n    img.dataset.width = img.width;\r\n    img.height =\r\n      img.dataset.height * containerScale * (v.initial.scale || 1);\r\n    img.width = img.dataset.width * containerScale * (v.initial.scale || 1);\r\n  });\r\n});\r\n```\r\n\r\n如果没有调用$emit告诉父组件显示静态图片\r\n\r\n获取容器和宽高缩放等属性，并且设置父组件获取图片的宽高等属性 并且根据缩放比例计算\r\n\r\n```javascript\r\n// 初始化图层\r\nconst layers = layerConfig.map((v) =\u003e {\r\n  const layer = document.createElement(\"div\");\r\n  layer.classList.add(\"layer\");\r\n  container.appendChild(layer);\r\n  return layer;\r\n});\r\n```\r\n\r\n初始化图层到container\r\n\r\n```javascript\r\n// 初始状态\r\nconst iaf = () =\u003e {\r\n  try {\r\n    layers.map((layer, i) =\u003e {\r\n      // console.log(\"layer log\", i, layer);\r\n      const v = layerConfig[i];\r\n      const a = layer.firstChild;\r\n      // console.log(\"a\", a);\r\n      let rotateStr = \"\";\r\n      let translateStr = \"\";\r\n      if (v.initial.rotate) {\r\n        rotateStr = `rotate(${v.initial.rotate}deg)`;\r\n      }\r\n      if (v.initial.translate) {\r\n        const base = v.initial.translate || [0, 0];\r\n        translateStr = `translate(${base[0]}px, ${base[1]}px)`;\r\n      }\r\n      a.style.transform = `${translateStr} ${rotateStr}`;\r\n      if (v.initial.blur) {\r\n        a.style.filter = `blur(${Math.abs(v.initial.blur)}px)`;\r\n      }\r\n    });\r\n  } catch (e) {\r\n    console.error(e);\r\n    this.$emit(\"error\");\r\n  }\r\n};\r\n\r\n// 切换下一帧的方法\r\nconst changeToNextFrame = (layer, images, i) =\u003e {\r\n  setTimeout(() =\u003e {\r\n    const next = i === images.length - 1 ? 0 : i + 1;\r\n    layer.removeChild(layer.firstChild);\r\n    layer.appendChild(images[next].img);\r\n    changeToNextFrame(layer, images, next);\r\n    requestAnimationFrame(af);\r\n  }, images[i].duration);\r\n};\r\n\r\n// 初始化图层内图片和帧动画\r\nlayerConfig.map((v, i) =\u003e {\r\n  const a = v.images[0].img;\r\n  layers[i].appendChild(a);\r\n  requestAnimationFrame(iaf);\r\n  if (v.images.length \u003e 1 \u0026\u0026 v.loopTime \u003e 0) {\r\n    changeToNextFrame(layers[i], v.images, 0);\r\n  }\r\n});\r\n```\r\n\r\n初始化图层图片和一些默认样式并且开始帧动画\r\n\r\n利用定时器loop toggle img 删除第一个元素然后添加下一帧图片然后再调用自己\r\n\r\n```javascript\r\ndocument.addEventListener(\"mouseleave\", this.handleMouseLeave);\r\nwindow.addEventListener(\"mousemove\", this.handleMouseMove);\r\nwindow.addEventListener(\"resize\", this.handleResize);\r\n\r\nbeforeDestroy() {\r\n  document.removeEventListener(\"mouseleave\", this.handleMouseLeave);\r\n  window.removeEventListener(\"mousemove\", this.handleMouseMove);\r\n  window.removeEventListener(\"resize\", this.handleResize);\r\n},\r\n```\r\n\r\n监听一些事件\r\n\r\n```javascript\r\nthis.handleMouseMove = (e) =\u003e {\r\n  const offsetY = document.documentElement.scrollTop + e.clientY;\r\n  console.log(\"offsetY\", offsetY, e);\r\n  if (offsetY \u003c containerHeight) {\r\n    if (!entered) {\r\n      entered = true;\r\n      enterX = e.clientX;\r\n    }\r\n    displace = (e.clientX - enterX) / containerWidth;\r\n    cancelAnimationFrame(raf);\r\n    raf = requestAnimationFrame(af);\r\n  } else {\r\n    if (entered) {\r\n      entered = false;\r\n      handleLeave();\r\n    }\r\n  }\r\n};\r\n```\r\n\r\n鼠标经过容器执行af 先取消再继续，不在容器内调用 handleLeave\r\n\r\n```javascript\r\nenterX = e.clientX;\r\ndisplace = (e.clientX - enterX) / containerWidth;\r\n```\r\n\r\n这两个的含义其实我还没太理解 后续需要用 displace 参与计算 应该就是用来判断往左还是右边的\r\n\r\n```javascript\r\n// 根据鼠标位置改变状态\r\nconst af = (t) =\u003e {\r\n  try {\r\n    layers.map((layer, i) =\u003e {\r\n      const v = layerConfig[i];\r\n      const a = layer.firstChild;\r\n      if (!v.offset || !a) {\r\n        return;\r\n      }\r\n\r\n      const baseRotate = v.initial.rotate || 0;\r\n      const baseTranslate = v.initial.trannslate || [0, 0];\r\n      let scaleStr = ``;\r\n      let rotateStr = `rotate(${v.initial.rotate || 0}deg)`;\r\n      let translateStr = `translate(${baseTranslate[0]}px, ${baseTranslate[1]}px)`;\r\n\r\n      console.log(\r\n        \"rotateStr translateStr\",\r\n        rotateStr,\r\n        translateStr,\r\n        v.offset\r\n      );\r\n\r\n      if (v.offset.scale) {\r\n        const itp =\r\n              v.offsetCurve \u0026\u0026 v.offsetCurve.scale\r\n        ? curveParameterToFunc(v.offsetCurve.scale)\r\n        : (x) =\u003e x;\r\n        const offset = v.offset.scale * itp(displace);\r\n        scaleStr = `scale(${1 + offset})`;\r\n      }\r\n      if (v.offset.rotate) {\r\n        const itp =\r\n              v.offsetCurve \u0026\u0026 v.offsetCurve.rotate\r\n        ? curveParameterToFunc(v.offsetCurve.rotate)\r\n        : (x) =\u003e x;\r\n        const offset = v.offset.rotate * itp(displace);\r\n        rotateStr = `rotate(${baseRotate + offset}deg)`;\r\n      }\r\n      if (v.offset.translate) {\r\n        const itp =\r\n              v.offsetCurve \u0026\u0026 v.offsetCurve.translate\r\n        ? curveParameterToFunc(v.offsetCurve.translate)\r\n        : (x) =\u003e x;\r\n        const offset = v.offset.translate.map((v) =\u003e itp(displace) * v);\r\n        const translate = baseTranslate.map(\r\n          (x, i) =\u003e\r\n          (x + offset[i]) * containerScale * (v.initial.scale || 1)\r\n        );\r\n        translateStr = `translate(${translate[0]}px, ${translate[1]}px)`;\r\n      }\r\n      a.style.transform = `${scaleStr} ${translateStr} ${rotateStr}`;\r\n      if (v.offset.blur) {\r\n        const itp =\r\n              v.offsetCurve \u0026\u0026 v.offsetCurve.blur\r\n        ? curveParameterToFunc(v.offsetCurve.blur)\r\n        : (x) =\u003e x;\r\n        const blurOffset = itp(displace) * v.offset.blur;\r\n        a.style.filter = `blur(${Math.abs(\r\n          (v.initial.blur || 0) + blurOffset\r\n        )}px)`;\r\n      }\r\n    });\r\n  } catch (e) {\r\n    console.error(e);\r\n    this.$emit(\"error\");\r\n  }\r\n};\r\n```\r\n\r\n关键代码在这里...\r\n\r\n1. 判断有没有元素\r\n\r\n2. 获取一些初始的style\r\n\r\n3. 然后判断有没有offset scale rotate translate blur 然后执行动画\r\n\r\n4. 判断有没有 offset curve 如果有用 cubicBezier 没有就用默认参数\r\n\r\n5. 往右边 x2 \u003e x1 / width 正数\r\n\r\n   1. Scale 默认是 1\r\n\r\n      ```javascript\r\n      const offset = v.offset.scale * itp(displace);\r\n      scaleStr = `scale(${1 + offset})`;\r\n      ```\r\n\r\n   2. Rotate 根据上面定义的默认参数然后加上新角度\r\n\r\n      ```javascript\r\n      const offset = v.offset.rotate * itp(displace);\r\n      rotateStr = `rotate(${baseRotate + offset}deg)`;\r\n      ```\r\n\r\n   3. Translate 根据比例计算\r\n\r\n      ```javascript\r\n      const offset = v.offset.translate.map((v) =\u003e itp(displace) * v);\r\n      const translate = baseTranslate.map(\r\n        (x, i) =\u003e\r\n        (x + offset[i]) * containerScale * (v.initial.scale || 1)\r\n      );\r\n      translateStr = `translate(${translate[0]}px, ${translate[1]}px)`;\r\n      ```\r\n\r\n      因为是个arr所以map loop，后面的 * 容器比例 * 初始化scale 应该是适配缩放的比例然后变化位置\r\n\r\n      ```javascript\r\n      a.style.transform = `${scaleStr} ${translateStr} ${rotateStr}`;\r\n      ```\r\n\r\n      最后设置属性\r\n\r\n   4. blur 初始的blur + 变化后的blur\r\n\r\n      ```javascript\r\n      const blurOffset = itp(displace) * v.offset.blur;\r\n      a.style.filter = `blur(${Math.abs(\r\n        (v.initial.blur || 0) + blurOffset\r\n      )}px)`;\r\n      ```\r\n\r\n```javascript\r\nconst handleLeave = () =\u003e {\r\n  const now = performance.now();\r\n  const timeout = 200;\r\n  const tempDisplace = displace;\r\n  cancelAnimationFrame(raf);\r\n  const leaveAF = (t) =\u003e {\r\n    if (t - now \u003c timeout) {\r\n      displace = tempDisplace * (1 - (t - now) / 200);\r\n      af(t);\r\n      requestAnimationFrame(leaveAF);\r\n    } else {\r\n      displace = 0;\r\n      af(t);\r\n    }\r\n  };\r\n  raf = requestAnimationFrame(leaveAF);\r\n};\r\n```\r\n\r\n鼠标离开后 在200time内displace会逐渐变小或扩大 取决于正数还是负数 超过时间后会设置为 0 然后调用动画恢复默认参数\r\n\r\n```javascript\r\nthis.handleResize = () =\u003e {\r\n  containerHeight = container.clientHeight;\r\n  containerWidth = container.clientWidth;\r\n  containerScale = containerHeight / 155;\r\n  layerConfig.forEach((lc) =\u003e {\r\n    lc.images.forEach((i) =\u003e {\r\n      const img = i.img;\r\n      img.height =\r\n        img.dataset.height * containerScale * (lc.initial.scale || 1);\r\n      img.width =\r\n        img.dataset.width * containerScale * (lc.initial.scale || 1);\r\n    });\r\n  });\r\n  cancelAnimationFrame(raf);\r\n  raf = requestAnimationFrame((t) =\u003e {\r\n    af(t);\r\n  });\r\n};\r\n```\r\n\r\n 设置容器的样式参数然后取消动画再开始动画赋值给raf\r\n\r\n","comments":{"nodes":[]},"reactionGroups":[{"content":"THUMBS_UP","reactors":{"totalCount":0}},{"content":"THUMBS_DOWN","reactors":{"totalCount":0}},{"content":"LAUGH","reactors":{"totalCount":0}},{"content":"HOORAY","reactors":{"totalCount":0}},{"content":"CONFUSED","reactors":{"totalCount":0}},{"content":"HEART","reactors":{"totalCount":0}},{"content":"ROCKET","reactors":{"totalCount":0}},{"content":"EYES","reactors":{"totalCount":0}}],"author":{"login":"xiaotiandada","url":"https://github.com/xiaotiandada","avatarUrl":"https://avatars.githubusercontent.com/u/24250627?u=51a93e07957381123eb9fbdd6407de36033b578d\u0026v=4"},"html":"\u003cp\u003e 2020-11-16 21:52:56\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://i.imgur.com/2BWZJjY.jpg?1\" alt=\"动画效果\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://www.bilibili.com/\"\u003ehttps://www.bilibili.com/\u003c/a\u003e 后面可能会被更新掉\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e 为什么叫一？ 说不能还有别的好玩的动画学习！\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c!-- more --\u003e\n\n\u003ciframe src=\"https://codesandbox.io/embed/bilibili-bannner-w49d7?fontsize=14\u0026hidenavigation=1\u0026theme=dark\u0026view=preview\"\n     style=\"width:100%; height:200px; border:0; border-radius: 4px; overflow:hidden;\"\n     title=\"bilibili bannner\"\n     allow=\"accelerometer; ambient-light-sensor; camera; encrypted-media; geolocation; gyroscope; hid; microphone; midi; payment; usb; vr; xr-spatial-tracking\"\n     sandbox=\"allow-forms allow-modals allow-popups allow-presentation allow-same-origin allow-scripts\"\n   \u003e\u003c/iframe\u003e\n\n\u003cp\u003e主要两个组件完成，代码我也是复制b站大佬的🍑 然后自己理解理解思路\u003c/p\u003e\n\u003ch3 id=\"bannervue\"\u003eBanner.vue\u003c/h3\u003e\n\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e  \u003cspan class=\"token literal-property property\"\u003ecomputed\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003elocs\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"token comment\"\u003e//...\u003c/span\u003e\n        \u003cspan class=\"token literal-property property\"\u003epic\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"token string\"\u003e\"http://i0.hdslb.com/bfs/archive/0b7eef054547750e6bfeff6f36c83e83d2a058fb.png\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token literal-property property\"\u003elitpic\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"token string\"\u003e\"http://i0.hdslb.com/bfs/archive/622017dd4b0140432962d3ce0c6db99d77d2e937.png\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"token comment\"\u003e//...\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003ebannerImg\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003elocs \u003cspan class=\"token operator\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003elocs\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epic\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003etrim\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003elogoImg\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003elocs \u003cspan class=\"token operator\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003elocs\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003elitpic\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003etrim\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e返回一张静止的页面，在没有加载完成或者不支持的时候显示\u003c/p\u003e\n\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"token comment\"\u003e// 解析数据 提前定义好的具体看代码\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003elayerConfig \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token constant\"\u003eJSON\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eparse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'[...]'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e解析banner数据\u003c/p\u003e\n\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"token comment\"\u003e// 只有在启用了动画banner的配置，且浏览器支持css filter时才加载动画banner的图片资源\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eanimatedBannerSupport \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003etypeof\u003c/span\u003e \u003cspan class=\"token constant\"\u003eCSS\u003c/span\u003e \u003cspan class=\"token operator\"\u003e!==\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"undefined\"\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e\n  \u003cspan class=\"token constant\"\u003eCSS\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esupports \u003cspan class=\"token operator\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e\n  \u003cspan class=\"token constant\"\u003eCSS\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003esupports\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"filter: blur(1px)\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e查看是否支持一些需要的条件\u003c/p\u003e\n\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"token comment\"\u003e// 根据每帧时长计算循环时间\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003elayerConfig\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003emap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003ev\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  v\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eloopTime \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e v\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eimages\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ereduce\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003ep\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e c\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e p \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ec\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eduration \u003cspan class=\"token operator\"\u003e||\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e统计所有Time 利用 Reduce 累计\u003c/p\u003e\n\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"token keyword\"\u003etry\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e// 加载所有图片资源\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003eawait\u003c/span\u003e Promise\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eall\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003elayerConfig\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003emap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003ev\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      console\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"v\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e v\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e Promise\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eall\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n        v\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eimages\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003emap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003ei\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e index\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n          \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e img \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e document\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ecreateElement\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"img\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n          img\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esrc \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e i\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esrc\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n          \u003cspan class=\"token keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003ePromise\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003eresolve\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eimg\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eonload \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e resolve\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n          v\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eimages\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003eindex\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eimg \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e img\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  console\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"this.layerConfig\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003elayerConfig\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e// 切换为动画banner\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eanimatedBannerLoaded \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ecatch\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ee\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  console\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"load animated banner images error\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e利用Promise加载所有图片资源，两个Promise是因为images里面也是一个数组\u003c/p\u003e\n\u003cp\u003e可以用这种方法提前加载图片 这样切换的时候就不会很卡顿 嗯 学习了！\u003c/p\u003e\n\u003ch3 id=\"animatedbanner\"\u003eAnimatedBanner\u003c/h3\u003e\n\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"token literal-property property\"\u003eprops\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token literal-property property\"\u003elayerConfig\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token literal-property property\"\u003etype\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e Array\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"token literal-property property\"\u003erequired\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e接收父组件处理好的数组数据\u003c/p\u003e\n\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e layerConfig \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003elayerConfig\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e!\u003c/span\u003elayerConfig\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003elength\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003e$emit\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"error\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e container \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e$refs\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"container\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e containerHeight \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e container\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eclientHeight\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e containerWidth \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e container\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eclientWidth\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e containerScale \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e containerHeight \u003cspan class=\"token operator\"\u003e/\u003c/span\u003e \u003cspan class=\"token number\"\u003e155\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// 加载图片资源移动到组件外部， 这里只设置图片宽高\u003c/span\u003e\nlayerConfig\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eforEach\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003ev\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  v\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eimages\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eforEach\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003ei\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e index\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e img \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e v\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eimages\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003eindex\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eimg\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    img\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edataset\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eheight \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e img\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eheight\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    img\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edataset\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ewidth \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e img\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ewidth\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    img\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eheight \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n      img\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edataset\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eheight \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e containerScale \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ev\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003einitial\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003escale \u003cspan class=\"token operator\"\u003e||\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    img\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ewidth \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e img\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edataset\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ewidth \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e containerScale \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ev\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003einitial\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003escale \u003cspan class=\"token operator\"\u003e||\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e如果没有调用$emit告诉父组件显示静态图片\u003c/p\u003e\n\u003cp\u003e获取容器和宽高缩放等属性，并且设置父组件获取图片的宽高等属性 并且根据缩放比例计算\u003c/p\u003e\n\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"token comment\"\u003e// 初始化图层\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e layers \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e layerConfig\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003emap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003ev\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e layer \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e document\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ecreateElement\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"div\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  layer\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eclassList\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eadd\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"layer\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  container\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eappendChild\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003elayer\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e layer\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e初始化图层到container\u003c/p\u003e\n\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"token comment\"\u003e// 初始状态\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token function-variable function\"\u003eiaf\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003etry\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    layers\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003emap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003elayer\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e i\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token comment\"\u003e// console.log(\"layer log\", i, layer);\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e v \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e layerConfig\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ei\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e a \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e layer\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003efirstChild\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"token comment\"\u003e// console.log(\"a\", a);\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e rotateStr \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e translateStr \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ev\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003einitial\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003erotate\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        rotateStr \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token template-string\"\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003cspan class=\"token string\"\u003erotate(\u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e${\u003c/span\u003ev\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003einitial\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003erotate\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003edeg)\u003c/span\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ev\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003einitial\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etranslate\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e base \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e v\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003einitial\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etranslate \u003cspan class=\"token operator\"\u003e||\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        translateStr \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token template-string\"\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003cspan class=\"token string\"\u003etranslate(\u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e${\u003c/span\u003ebase\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003epx, \u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e${\u003c/span\u003ebase\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003epx)\u003c/span\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n      a\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003estyle\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etransform \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token template-string\"\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e${\u003c/span\u003etranslateStr\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003e \u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e${\u003c/span\u003erotateStr\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ev\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003einitial\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eblur\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        a\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003estyle\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003efilter \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token template-string\"\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003cspan class=\"token string\"\u003eblur(\u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e${\u003c/span\u003eMath\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eabs\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ev\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003einitial\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eblur\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003epx)\u003c/span\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ecatch\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ee\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    console\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eerror\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ee\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003e$emit\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"error\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// 切换下一帧的方法\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token function-variable function\"\u003echangeToNextFrame\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003elayer\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e images\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e i\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003esetTimeout\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e next \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e i \u003cspan class=\"token operator\"\u003e===\u003c/span\u003e images\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003elength \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e \u003cspan class=\"token operator\"\u003e?\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e \u003cspan class=\"token operator\"\u003e:\u003c/span\u003e i \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    layer\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eremoveChild\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003elayer\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003efirstChild\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    layer\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eappendChild\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eimages\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003enext\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eimg\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003echangeToNextFrame\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003elayer\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e images\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e next\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003erequestAnimationFrame\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eaf\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e images\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ei\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eduration\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// 初始化图层内图片和帧动画\u003c/span\u003e\nlayerConfig\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003emap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003ev\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e i\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e a \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e v\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eimages\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eimg\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  layers\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ei\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eappendChild\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ea\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003erequestAnimationFrame\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eiaf\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ev\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eimages\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003elength \u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e v\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eloopTime \u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003echangeToNextFrame\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003elayers\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ei\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e v\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eimages\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e初始化图层图片和一些默认样式并且开始帧动画\u003c/p\u003e\n\u003cp\u003e利用定时器loop toggle img 删除第一个元素然后添加下一帧图片然后再调用自己\u003c/p\u003e\n\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003edocument\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eaddEventListener\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"mouseleave\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ehandleMouseLeave\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\nwindow\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eaddEventListener\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"mousemove\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ehandleMouseMove\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\nwindow\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eaddEventListener\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"resize\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ehandleResize\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token function\"\u003ebeforeDestroy\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  document\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eremoveEventListener\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"mouseleave\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ehandleMouseLeave\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  window\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eremoveEventListener\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"mousemove\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ehandleMouseMove\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  window\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eremoveEventListener\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"resize\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ehandleResize\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e监听一些事件\u003c/p\u003e\n\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function-variable function\"\u003ehandleMouseMove\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003ee\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e offsetY \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e document\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edocumentElement\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003escrollTop \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eclientY\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  console\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"offsetY\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e offsetY\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eoffsetY \u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003e containerHeight\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e!\u003c/span\u003eentered\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      entered \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      enterX \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eclientX\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    displace \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ee\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eclientX \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e enterX\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e/\u003c/span\u003e containerWidth\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003ecancelAnimationFrame\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eraf\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    raf \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003erequestAnimationFrame\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eaf\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eentered\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      entered \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token boolean\"\u003efalse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"token function\"\u003ehandleLeave\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e鼠标经过容器执行af 先取消再继续，不在容器内调用 handleLeave\u003c/p\u003e\n\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003eenterX \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eclientX\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\ndisplace \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ee\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eclientX \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e enterX\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e/\u003c/span\u003e containerWidth\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e这两个的含义其实我还没太理解 后续需要用 displace 参与计算 应该就是用来判断往左还是右边的\u003c/p\u003e\n\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"token comment\"\u003e// 根据鼠标位置改变状态\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token function-variable function\"\u003eaf\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003et\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003etry\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    layers\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003emap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003elayer\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e i\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e v \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e layerConfig\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ei\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e a \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e layer\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003efirstChild\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e!\u003c/span\u003ev\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eoffset \u003cspan class=\"token operator\"\u003e||\u003c/span\u003e \u003cspan class=\"token operator\"\u003e!\u003c/span\u003ea\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n      \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e baseRotate \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e v\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003einitial\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003erotate \u003cspan class=\"token operator\"\u003e||\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e baseTranslate \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e v\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003einitial\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etrannslate \u003cspan class=\"token operator\"\u003e||\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e scaleStr \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token template-string\"\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e rotateStr \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token template-string\"\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003cspan class=\"token string\"\u003erotate(\u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e${\u003c/span\u003ev\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003einitial\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003erotate \u003cspan class=\"token operator\"\u003e||\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003edeg)\u003c/span\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e translateStr \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token template-string\"\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003cspan class=\"token string\"\u003etranslate(\u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e${\u003c/span\u003ebaseTranslate\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003epx, \u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e${\u003c/span\u003ebaseTranslate\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003epx)\u003c/span\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n      console\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"token string\"\u003e\"rotateStr translateStr\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        rotateStr\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        translateStr\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        v\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eoffset\n      \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n      \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ev\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eoffset\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003escale\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e itp \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n              v\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eoffsetCurve \u003cspan class=\"token operator\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e v\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eoffsetCurve\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003escale\n        \u003cspan class=\"token operator\"\u003e?\u003c/span\u003e \u003cspan class=\"token function\"\u003ecurveParameterToFunc\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ev\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eoffsetCurve\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003escale\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003ex\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e x\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e offset \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e v\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eoffset\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003escale \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token function\"\u003eitp\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edisplace\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        scaleStr \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token template-string\"\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003cspan class=\"token string\"\u003escale(\u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e${\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e offset\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003e)\u003c/span\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ev\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eoffset\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003erotate\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e itp \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n              v\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eoffsetCurve \u003cspan class=\"token operator\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e v\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eoffsetCurve\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003erotate\n        \u003cspan class=\"token operator\"\u003e?\u003c/span\u003e \u003cspan class=\"token function\"\u003ecurveParameterToFunc\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ev\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eoffsetCurve\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003erotate\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003ex\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e x\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e offset \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e v\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eoffset\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003erotate \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token function\"\u003eitp\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edisplace\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        rotateStr \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token template-string\"\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003cspan class=\"token string\"\u003erotate(\u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e${\u003c/span\u003ebaseRotate \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e offset\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003edeg)\u003c/span\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ev\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eoffset\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etranslate\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e itp \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n              v\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eoffsetCurve \u003cspan class=\"token operator\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e v\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eoffsetCurve\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etranslate\n        \u003cspan class=\"token operator\"\u003e?\u003c/span\u003e \u003cspan class=\"token function\"\u003ecurveParameterToFunc\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ev\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eoffsetCurve\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etranslate\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003ex\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e x\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e offset \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e v\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eoffset\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etranslate\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003emap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003ev\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003eitp\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edisplace\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e v\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e translate \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e baseTranslate\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003emap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n          \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003ex\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e i\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e\n          \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ex \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e offset\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ei\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e containerScale \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ev\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003einitial\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003escale \u003cspan class=\"token operator\"\u003e||\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        translateStr \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token template-string\"\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003cspan class=\"token string\"\u003etranslate(\u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e${\u003c/span\u003etranslate\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003epx, \u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e${\u003c/span\u003etranslate\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003epx)\u003c/span\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n      a\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003estyle\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etransform \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token template-string\"\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e${\u003c/span\u003escaleStr\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003e \u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e${\u003c/span\u003etranslateStr\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003e \u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e${\u003c/span\u003erotateStr\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ev\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eoffset\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eblur\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e itp \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n              v\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eoffsetCurve \u003cspan class=\"token operator\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e v\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eoffsetCurve\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eblur\n        \u003cspan class=\"token operator\"\u003e?\u003c/span\u003e \u003cspan class=\"token function\"\u003ecurveParameterToFunc\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ev\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eoffsetCurve\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eblur\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003ex\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e x\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e blurOffset \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003eitp\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edisplace\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e v\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eoffset\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eblur\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        a\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003estyle\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003efilter \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token template-string\"\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003cspan class=\"token string\"\u003eblur(\u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e${\u003c/span\u003eMath\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eabs\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n          \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ev\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003einitial\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eblur \u003cspan class=\"token operator\"\u003e||\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e blurOffset\n        \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003epx)\u003c/span\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ecatch\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ee\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    console\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eerror\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ee\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003e$emit\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"error\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e关键代码在这里...\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003cp\u003e判断有没有元素\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e获取一些初始的style\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e然后判断有没有offset scale rotate translate blur 然后执行动画\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e判断有没有 offset curve 如果有用 cubicBezier 没有就用默认参数\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e往右边 x2 \u0026gt; x1 / width 正数\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003cp\u003eScale 默认是 1\u003c/p\u003e\n\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e offset \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e v\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eoffset\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003escale \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token function\"\u003eitp\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edisplace\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\nscaleStr \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token template-string\"\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003cspan class=\"token string\"\u003escale(\u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e${\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e offset\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003e)\u003c/span\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eRotate 根据上面定义的默认参数然后加上新角度\u003c/p\u003e\n\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e offset \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e v\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eoffset\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003erotate \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token function\"\u003eitp\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edisplace\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\nrotateStr \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token template-string\"\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003cspan class=\"token string\"\u003erotate(\u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e${\u003c/span\u003ebaseRotate \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e offset\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003edeg)\u003c/span\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eTranslate 根据比例计算\u003c/p\u003e\n\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e offset \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e v\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eoffset\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etranslate\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003emap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003ev\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003eitp\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edisplace\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e v\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e translate \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e baseTranslate\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003emap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003ex\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e i\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ex \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e offset\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ei\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e containerScale \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ev\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003einitial\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003escale \u003cspan class=\"token operator\"\u003e||\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\ntranslateStr \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token template-string\"\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003cspan class=\"token string\"\u003etranslate(\u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e${\u003c/span\u003etranslate\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003epx, \u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e${\u003c/span\u003etranslate\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003epx)\u003c/span\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e因为是个arr所以map loop，后面的 * 容器比例 * 初始化scale 应该是适配缩放的比例然后变化位置\u003c/p\u003e\n\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003ea\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003estyle\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etransform \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token template-string\"\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e${\u003c/span\u003escaleStr\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003e \u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e${\u003c/span\u003etranslateStr\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003e \u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e${\u003c/span\u003erotateStr\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e最后设置属性\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eblur 初始的blur + 变化后的blur\u003c/p\u003e\n\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e blurOffset \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003eitp\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edisplace\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e v\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eoffset\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eblur\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\na\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003estyle\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003efilter \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token template-string\"\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003cspan class=\"token string\"\u003eblur(\u003c/span\u003e\u003cspan class=\"token interpolation\"\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e${\u003c/span\u003eMath\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eabs\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ev\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003einitial\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eblur \u003cspan class=\"token operator\"\u003e||\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e blurOffset\n\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token interpolation-punctuation punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token string\"\u003epx)\u003c/span\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token function-variable function\"\u003ehandleLeave\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e now \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e performance\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003enow\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e timeout \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e200\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e tempDisplace \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e displace\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003ecancelAnimationFrame\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eraf\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token function-variable function\"\u003eleaveAF\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003et\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003et \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e now \u003cspan class=\"token operator\"\u003e\u0026lt;\u003c/span\u003e timeout\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      displace \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e tempDisplace \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003et \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e now\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e/\u003c/span\u003e \u003cspan class=\"token number\"\u003e200\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"token function\"\u003eaf\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003et\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"token function\"\u003erequestAnimationFrame\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eleaveAF\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      displace \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"token function\"\u003eaf\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003et\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  raf \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003erequestAnimationFrame\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eleaveAF\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e鼠标离开后 在200time内displace会逐渐变小或扩大 取决于正数还是负数 超过时间后会设置为 0 然后调用动画恢复默认参数\u003c/p\u003e\n\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function-variable function\"\u003ehandleResize\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  containerHeight \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e container\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eclientHeight\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  containerWidth \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e container\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eclientWidth\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  containerScale \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e containerHeight \u003cspan class=\"token operator\"\u003e/\u003c/span\u003e \u003cspan class=\"token number\"\u003e155\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  layerConfig\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eforEach\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003elc\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    lc\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eimages\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eforEach\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003ei\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e img \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e i\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eimg\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      img\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eheight \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n        img\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edataset\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eheight \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e containerScale \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003elc\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003einitial\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003escale \u003cspan class=\"token operator\"\u003e||\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      img\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ewidth \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n        img\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edataset\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ewidth \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e containerScale \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003elc\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003einitial\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003escale \u003cspan class=\"token operator\"\u003e||\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003ecancelAnimationFrame\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eraf\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  raf \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003erequestAnimationFrame\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003et\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003eaf\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003et\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e 设置容器的样式参数然后取消动画再开始动画赋值给raf\u003c/p\u003e\n","attributes":{}},"themeConfig":{"title":"Blog(issues)","links":[{"title":"GitHub","url":"https://github.com/xiaotiandada/blog"},{"title":"Twitter","url":"https://twitter.com/XiaoTianIsMe"}]}},"__N_SSG":true},"page":"/[...path]","query":{"path":["MDU6SXNzdWU3ODg3NTE4NDk="]},"buildId":"YPEk3V-eoVeml18YoUSCM","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>