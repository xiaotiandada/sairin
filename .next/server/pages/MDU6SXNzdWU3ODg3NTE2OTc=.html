<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>JFIF图片格式上传 - Blog(issues)</title><meta property="og:type" content="artical"/><meta property="og:title" content="JFIF图片格式上传"/><meta property="og:image" content="
        https://og-image.vercel.app/JFIF图片格式上传.png?theme=light&amp;md=1&amp;fontSize=100px&amp;images=https%3A%2F%2Fassets.vercel.com%2Fimage%2Fupload%2Ffront%2Fassets%2Fdesign%2Fvercel-triangle-black.svg
      "/><meta property="article:published_time" content="2021-01-19T06:40:01Z"/><meta property="article:author" content="xiaotiandada"/><meta name="twitter:card" content="JFIF图片格式上传"/><meta name="twitter:title" content="JFIF图片格式上传"/><meta name="twitter:image" content="
        https://og-image.vercel.app/JFIF图片格式上传.png?theme=light&amp;md=1&amp;fontSize=100px&amp;images=https%3A%2F%2Fassets.vercel.com%2Fimage%2Fupload%2Ffront%2Fassets%2Fdesign%2Fvercel-triangle-black.svg
      "/><meta name="next-head-count" content="4"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin=""/><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Serif:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&amp;display=swap" rel="stylesheet"/><link rel="preload" href="/_next/static/css/b78bfc7021c6877d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b78bfc7021c6877d.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-cb7634a8b6194820.js" defer=""></script><script src="/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="/_next/static/chunks/main-2190439a97dca295.js" defer=""></script><script src="/_next/static/chunks/pages/_app-2aac380799256b7f.js" defer=""></script><script src="/_next/static/chunks/pages/%5B...path%5D-e0b96643230aac68.js" defer=""></script><script src="/_next/static/YPEk3V-eoVeml18YoUSCM/_buildManifest.js" defer=""></script><script src="/_next/static/YPEk3V-eoVeml18YoUSCM/_ssgManifest.js" defer=""></script><script src="/_next/static/YPEk3V-eoVeml18YoUSCM/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div><div class="container mx-auto mt-24 max-w-2xl px-4 sm:px-0"><div><div class="flex my-8 font-bold"><a href="/">Blog(issues)</a></div></div><div class="mb-8"><div class="text-3xl font-medium">JFIF图片格式上传</div><div class="flex mt-4 items-center gap-2"><img class="w-8 h-8 rounded-full" src="https://avatars.githubusercontent.com/u/24250627?u=51a93e07957381123eb9fbdd6407de36033b578d&amp;v=4"/><a target="_blank" href="https://github.com/xiaotiandada">xiaotiandada</a><a class="underline text-sm" target="_blank" href="https://github.com/xiaotiandada/blog/issues/60">View on GitHub</a></div><div class="my-8"><div class="flex gap-4 flex-wrap"></div></div></div><div class="post-body"><p>2020-11-13 00:01:44</p>
<p>图片存储格式之一，由<a href="https://baike.baidu.com/item/JPEG">JPEG</a>格式衍生而来，后缀为&quot;.jfif&quot;。<a href="https://baike.baidu.com/item/jfif">JFIF</a></p>
<!-- more -->

<p>了解到一种新的图片格式JFIF 但是这种图片格式上传是导致失败 <code>Invalid filename</code>  </p>
<p>最后解决方案时候在前端上传的时候转换文件</p>
<p>如果没有图片的话可以在这里转换 <a href="https://convertio.co/zh/">https://convertio.co/zh/</a></p>
<p>前端：React Ant</p>
<p>后端：Nodejs Egg oss</p>
<blockquote>
<p>后端代码忽略了 参考: <a href="https://github.com/eggjs/egg-oss">https://github.com/eggjs/egg-oss</a></p>
</blockquote>
<p>前端用Ant的Upload <a href="https://ant.design/components/upload-cn/">https://ant.design/components/upload-cn/</a> </p>
<p>这里有篇介绍格式转换的 <a href="https://blog.csdn.net/qq_21937107/article/details/91424611">https://blog.csdn.net/qq_21937107/article/details/91424611</a></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
<th>类型</th>
<th>默认值</th>
<th>版本</th>
</tr>
</thead>
<tbody><tr>
<td>transformFile</td>
<td>在上传之前转换文件。支持返回一个 Promise 对象</td>
<td>function(file): string...</td>
<td>-</td>
<td></td>
</tr>
</tbody></table>
<pre class="language-typescript"><code class="language-typescript">function blobToFile(blob: any, fileName: string) {
  blob.lastModifiedDate = new Date();
  blob.name = fileName;
  return blob;
}

async function transformFile(file: File): Promise<string | Blob | File> {
  // https://blog.csdn.net/qq_21937107/article/details/91424611
  // base64 to blob then file
  console.log('file', file)
  try {
    const fileImg = await imageConversion.filetoDataURL(file)
    const blob = await imageConversion.dataURLtoFile(fileImg)

    const fileName = file.name.split('.')
    let fileType = fileName[fileName.length - 1]

    // 如果文件类型是 jfif 使用 jpg 否则使用默认
    if (fileType === 'jfif') {
      fileType = 'jpg'
    }
    const result = blobToFile(blob, `${fileName[0] || Date.now()}.${fileType}`)
    console.log('result', result)

    return result
  } catch (e) {
    console.log('e', e)
    return file
  }
}</code></pre><p> 利用 <a href="https://github.com/WangYuLue/image-conversion">imageConversion</a> 逻辑就是 File transform base64 to blob then file</p>
<pre class="language-typescript"><code class="language-typescript">// to base64
const fileImg = await imageConversion.filetoDataURL(file)
// to blob
const blob = await imageConversion.dataURLtoFile(fileImg)
// then file
blobToFile(blob, fileName)</code></pre><p>JFIF上传成功包括WEBP IOS预览也正常</p>
</div><hr class="my-12"/><div class="font-sans"><div class="mb-12"><a target="_blank" href="https://github.com/xiaotiandada/blog/issues/60" class="font-medium border border-gray-700 hover:bg-gray-700 hover:text-gray-100 transition-all text-gray-700 text-sm rounded px-4 py-2">Add comment</a></div></div><div class="my-12"><div class="text-sm">Powered by <a class="underline" target="_blank" href="https://github.com/djyde/sairin">Sairin</a></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"id":"MDU6SXNzdWU3ODg3NTE2OTc=","url":"https://github.com/xiaotiandada/blog/issues/60","title":"JFIF图片格式上传","updatedAt":"2021-01-19T06:40:01Z","createdAt":"2021-01-19T06:40:01Z","body":"2020-11-13 00:01:44\r\n\r\n图片存储格式之一，由[JPEG](https://baike.baidu.com/item/JPEG)格式衍生而来，后缀为\".jfif\"。[JFIF](https://baike.baidu.com/item/jfif)\r\n\r\n\u003c!-- more --\u003e\r\n\r\n了解到一种新的图片格式JFIF 但是这种图片格式上传是导致失败 `Invalid filename`  \r\n\r\n最后解决方案时候在前端上传的时候转换文件\r\n\r\n如果没有图片的话可以在这里转换 https://convertio.co/zh/\r\n\r\n前端：React Ant\r\n\r\n后端：Nodejs Egg oss\r\n\r\n\u003e 后端代码忽略了 参考: https://github.com/eggjs/egg-oss\r\n\r\n前端用Ant的Upload https://ant.design/components/upload-cn/ \r\n\r\n这里有篇介绍格式转换的 https://blog.csdn.net/qq_21937107/article/details/91424611\r\n\r\n| 参数          | 说明                                          | 类型                      | 默认值 | 版本 |\r\n| ------------- | --------------------------------------------- | ------------------------- | ------ | ---- |\r\n| transformFile | 在上传之前转换文件。支持返回一个 Promise 对象 | function(file): string... | -      |      |\r\n\r\n```typescript\r\nfunction blobToFile(blob: any, fileName: string) {\r\n  blob.lastModifiedDate = new Date();\r\n  blob.name = fileName;\r\n  return blob;\r\n}\r\n\r\nasync function transformFile(file: File): Promise\u003cstring | Blob | File\u003e {\r\n  // https://blog.csdn.net/qq_21937107/article/details/91424611\r\n  // base64 to blob then file\r\n  console.log('file', file)\r\n  try {\r\n    const fileImg = await imageConversion.filetoDataURL(file)\r\n    const blob = await imageConversion.dataURLtoFile(fileImg)\r\n\r\n    const fileName = file.name.split('.')\r\n    let fileType = fileName[fileName.length - 1]\r\n\r\n    // 如果文件类型是 jfif 使用 jpg 否则使用默认\r\n    if (fileType === 'jfif') {\r\n      fileType = 'jpg'\r\n    }\r\n    const result = blobToFile(blob, `${fileName[0] || Date.now()}.${fileType}`)\r\n    console.log('result', result)\r\n\r\n    return result\r\n  } catch (e) {\r\n    console.log('e', e)\r\n    return file\r\n  }\r\n}\r\n```\r\n\r\n 利用 [imageConversion](https://github.com/WangYuLue/image-conversion) 逻辑就是 File transform base64 to blob then file\r\n\r\n```typescript\r\n// to base64\r\nconst fileImg = await imageConversion.filetoDataURL(file)\r\n// to blob\r\nconst blob = await imageConversion.dataURLtoFile(fileImg)\r\n// then file\r\nblobToFile(blob, fileName)\r\n```\r\n\r\nJFIF上传成功包括WEBP IOS预览也正常\r\n\r\n","comments":{"nodes":[]},"reactionGroups":[{"content":"THUMBS_UP","reactors":{"totalCount":0}},{"content":"THUMBS_DOWN","reactors":{"totalCount":0}},{"content":"LAUGH","reactors":{"totalCount":0}},{"content":"HOORAY","reactors":{"totalCount":0}},{"content":"CONFUSED","reactors":{"totalCount":0}},{"content":"HEART","reactors":{"totalCount":0}},{"content":"ROCKET","reactors":{"totalCount":0}},{"content":"EYES","reactors":{"totalCount":0}}],"author":{"login":"xiaotiandada","url":"https://github.com/xiaotiandada","avatarUrl":"https://avatars.githubusercontent.com/u/24250627?u=51a93e07957381123eb9fbdd6407de36033b578d\u0026v=4"},"html":"\u003cp\u003e2020-11-13 00:01:44\u003c/p\u003e\n\u003cp\u003e图片存储格式之一，由\u003ca href=\"https://baike.baidu.com/item/JPEG\"\u003eJPEG\u003c/a\u003e格式衍生而来，后缀为\u0026quot;.jfif\u0026quot;。\u003ca href=\"https://baike.baidu.com/item/jfif\"\u003eJFIF\u003c/a\u003e\u003c/p\u003e\n\u003c!-- more --\u003e\n\n\u003cp\u003e了解到一种新的图片格式JFIF 但是这种图片格式上传是导致失败 \u003ccode\u003eInvalid filename\u003c/code\u003e  \u003c/p\u003e\n\u003cp\u003e最后解决方案时候在前端上传的时候转换文件\u003c/p\u003e\n\u003cp\u003e如果没有图片的话可以在这里转换 \u003ca href=\"https://convertio.co/zh/\"\u003ehttps://convertio.co/zh/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e前端：React Ant\u003c/p\u003e\n\u003cp\u003e后端：Nodejs Egg oss\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e后端代码忽略了 参考: \u003ca href=\"https://github.com/eggjs/egg-oss\"\u003ehttps://github.com/eggjs/egg-oss\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e前端用Ant的Upload \u003ca href=\"https://ant.design/components/upload-cn/\"\u003ehttps://ant.design/components/upload-cn/\u003c/a\u003e \u003c/p\u003e\n\u003cp\u003e这里有篇介绍格式转换的 \u003ca href=\"https://blog.csdn.net/qq_21937107/article/details/91424611\"\u003ehttps://blog.csdn.net/qq_21937107/article/details/91424611\u003c/a\u003e\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e参数\u003c/th\u003e\n\u003cth\u003e说明\u003c/th\u003e\n\u003cth\u003e类型\u003c/th\u003e\n\u003cth\u003e默认值\u003c/th\u003e\n\u003cth\u003e版本\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd\u003etransformFile\u003c/td\u003e\n\u003ctd\u003e在上传之前转换文件。支持返回一个 Promise 对象\u003c/td\u003e\n\u003ctd\u003efunction(file): string...\u003c/td\u003e\n\u003ctd\u003e-\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003cpre class=\"language-typescript\"\u003e\u003ccode class=\"language-typescript\"\u003efunction blobToFile(blob: any, fileName: string) {\n  blob.lastModifiedDate = new Date();\n  blob.name = fileName;\n  return blob;\n}\n\nasync function transformFile(file: File): Promise\u003cstring | Blob | File\u003e {\n  // https://blog.csdn.net/qq_21937107/article/details/91424611\n  // base64 to blob then file\n  console.log('file', file)\n  try {\n    const fileImg = await imageConversion.filetoDataURL(file)\n    const blob = await imageConversion.dataURLtoFile(fileImg)\n\n    const fileName = file.name.split('.')\n    let fileType = fileName[fileName.length - 1]\n\n    // 如果文件类型是 jfif 使用 jpg 否则使用默认\n    if (fileType === 'jfif') {\n      fileType = 'jpg'\n    }\n    const result = blobToFile(blob, `${fileName[0] || Date.now()}.${fileType}`)\n    console.log('result', result)\n\n    return result\n  } catch (e) {\n    console.log('e', e)\n    return file\n  }\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e 利用 \u003ca href=\"https://github.com/WangYuLue/image-conversion\"\u003eimageConversion\u003c/a\u003e 逻辑就是 File transform base64 to blob then file\u003c/p\u003e\n\u003cpre class=\"language-typescript\"\u003e\u003ccode class=\"language-typescript\"\u003e// to base64\nconst fileImg = await imageConversion.filetoDataURL(file)\n// to blob\nconst blob = await imageConversion.dataURLtoFile(fileImg)\n// then file\nblobToFile(blob, fileName)\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eJFIF上传成功包括WEBP IOS预览也正常\u003c/p\u003e\n","attributes":{}},"themeConfig":{"title":"Blog(issues)","links":[{"title":"GitHub","url":"https://github.com/xiaotiandada/blog"},{"title":"Twitter","url":"https://twitter.com/XiaoTianIsMe"}]}},"__N_SSG":true},"page":"/[...path]","query":{"path":["MDU6SXNzdWU3ODg3NTE2OTc="]},"buildId":"YPEk3V-eoVeml18YoUSCM","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>