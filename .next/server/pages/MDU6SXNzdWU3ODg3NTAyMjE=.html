<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>让Mocha支持es6语法 - Blog(issues)</title><meta property="og:type" content="artical"/><meta property="og:title" content="让Mocha支持es6语法"/><meta property="og:image" content="
        https://og-image.vercel.app/让Mocha支持es6语法.png?theme=light&amp;md=1&amp;fontSize=100px&amp;images=https%3A%2F%2Fassets.vercel.com%2Fimage%2Fupload%2Ffront%2Fassets%2Fdesign%2Fvercel-triangle-black.svg
      "/><meta property="article:published_time" content="2021-01-19T06:37:07Z"/><meta property="article:author" content="xiaotiandada"/><meta name="twitter:card" content="让Mocha支持es6语法"/><meta name="twitter:title" content="让Mocha支持es6语法"/><meta name="twitter:image" content="
        https://og-image.vercel.app/让Mocha支持es6语法.png?theme=light&amp;md=1&amp;fontSize=100px&amp;images=https%3A%2F%2Fassets.vercel.com%2Fimage%2Fupload%2Ffront%2Fassets%2Fdesign%2Fvercel-triangle-black.svg
      "/><meta name="next-head-count" content="4"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin=""/><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Serif:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&amp;display=swap" rel="stylesheet"/><link rel="preload" href="/_next/static/css/b78bfc7021c6877d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b78bfc7021c6877d.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-cb7634a8b6194820.js" defer=""></script><script src="/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="/_next/static/chunks/main-2190439a97dca295.js" defer=""></script><script src="/_next/static/chunks/pages/_app-2aac380799256b7f.js" defer=""></script><script src="/_next/static/chunks/pages/%5B...path%5D-e0b96643230aac68.js" defer=""></script><script src="/_next/static/YPEk3V-eoVeml18YoUSCM/_buildManifest.js" defer=""></script><script src="/_next/static/YPEk3V-eoVeml18YoUSCM/_ssgManifest.js" defer=""></script><script src="/_next/static/YPEk3V-eoVeml18YoUSCM/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div><div class="container mx-auto mt-24 max-w-2xl px-4 sm:px-0"><div><div class="flex my-8 font-bold"><a href="/">Blog(issues)</a></div></div><div class="mb-8"><div class="text-3xl font-medium">让Mocha支持es6语法</div><div class="flex mt-4 items-center gap-2"><img class="w-8 h-8 rounded-full" src="https://avatars.githubusercontent.com/u/24250627?u=51a93e07957381123eb9fbdd6407de36033b578d&amp;v=4"/><a target="_blank" href="https://github.com/xiaotiandada">xiaotiandada</a><a class="underline text-sm" target="_blank" href="https://github.com/xiaotiandada/blog/issues/51">View on GitHub</a></div><div class="my-8"><div class="flex gap-4 flex-wrap"></div></div></div><div class="post-body"><p>2020-07-08 18:23:34</p>
<p>因为 Mocha 默认支持 commonJS</p>
<p>参考资料 <a href="https://greenfavo.github.io/blog/docs/02.html">https://greenfavo.github.io/blog/docs/02.html</a></p>
<!-- more -->

<p>如果直接引入 import 会报错, 这让 写 es 语法的时候无法通过 import 来直接测试</p>
<p>这里借助 babel 转换	</p>
<p>定义 <strong>scripts</strong> 运行 <strong>test</strong> Mocha 会自动执行 test 目录的测试代码</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token string-property property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token string-property property">"test"</span><span class="token operator">:</span> <span class="token string">"mocha"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></code></pre><p>为了支持es6语法，加上以下代码</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token string-property property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token string-property property">"test"</span><span class="token operator">:</span> <span class="token string">"mocha --require babel-register --bail"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></code></pre><p>安装依赖</p>
<pre class="language-bash"><code class="language-bash">npm install babel-register  babel-preset-env -D</code></pre><p>新建 <strong>.babelrc</strong> </p>
<pre class="language-json"><code class="language-json">{
  "presets": [
    ["env"]
  ]
}</code></pre><p>babel会自动读取<code>.babelrc</code>配置文件，这样就让我们的Mocha代码支持es6的模块系统和es6的其他语法了</p>
<p>运行</p>
<pre class="language-bash"><code class="language-bash">npm run test</code></pre><p>Mocha配置说明 (纯复制</p>
<blockquote>
<p>Mocha的两个配置--require和--bail,官方文档是这样说的：</p>
<p>–require</p>
<p>The –require option is useful for libraries such as should.js, so you may simply –require should instead of manually invoking require(‘should’) within each test file.</p>
<p>意思是--require和在代码里手动require(&#39;babel-register&#39;)一样，但写在配置里会作用到每个test文件。默认支持.es .js .jsx扩展名. 老版本的Mocha使用--compilers命令支持其他文件扩展名，但在4.0后就废弃掉了。</p>
<p>–bail</p>
<p>Only interested in the first exception? use –bail!</p>
<p>--bail可以在第一个异常抛出的时候停止运行测试,这对集成测试很重要。</p>
<p>About Babel</p>
<p>If your ES6 modules have extension .js, you can npm install –save-dev babel-register and use mocha –require babel-register; –compilers is only necessary if you need to specify a file extension.</p>
<p>babel-register可以让Mocha支持ES6 module，就是import export 写法.</p>
<p>babel-preset-env在没有任何配置选项的情况下，与 babel-preset-latest（或者babel-preset-es2015，babel-preset-es2016和babel-preset-es2017一起）的行为完全相同。官方推荐使用babel-preset-env.</p>
</blockquote>
</div><hr class="my-12"/><div class="font-sans"><div class="mb-12"><a target="_blank" href="https://github.com/xiaotiandada/blog/issues/51" class="font-medium border border-gray-700 hover:bg-gray-700 hover:text-gray-100 transition-all text-gray-700 text-sm rounded px-4 py-2">Add comment</a></div></div><div class="my-12"><div class="text-sm">Powered by <a class="underline" target="_blank" href="https://github.com/djyde/sairin">Sairin</a></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"id":"MDU6SXNzdWU3ODg3NTAyMjE=","url":"https://github.com/xiaotiandada/blog/issues/51","title":"让Mocha支持es6语法","updatedAt":"2021-01-19T06:37:07Z","createdAt":"2021-01-19T06:37:07Z","body":"2020-07-08 18:23:34\r\n\r\n因为 Mocha 默认支持 commonJS\r\n\r\n参考资料 https://greenfavo.github.io/blog/docs/02.html\r\n\r\n\u003c!-- more --\u003e\r\n\r\n如果直接引入 import 会报错, 这让 写 es 语法的时候无法通过 import 来直接测试\r\n\r\n这里借助 babel 转换\t\r\n\r\n定义 **scripts** 运行 **test** Mocha 会自动执行 test 目录的测试代码\r\n\r\n```javascript\r\n\"scripts\": {\r\n  \"test\": \"mocha\",\r\n}\r\n```\r\n\r\n为了支持es6语法，加上以下代码\r\n\r\n```javascript\r\n\"scripts\": {\r\n  \"test\": \"mocha --require babel-register --bail\",\r\n}\r\n```\r\n\r\n安装依赖\r\n\r\n```bash\r\nnpm install babel-register  babel-preset-env -D\r\n```\r\n\r\n新建 **.babelrc** \r\n\r\n```json\r\n{\r\n  \"presets\": [\r\n    [\"env\"]\r\n  ]\r\n}\r\n```\r\n\r\nbabel会自动读取`.babelrc`配置文件，这样就让我们的Mocha代码支持es6的模块系统和es6的其他语法了\r\n\r\n运行\r\n\r\n```bash\r\nnpm run test\r\n```\r\n\r\nMocha配置说明 (纯复制\r\n\r\n\u003eMocha的两个配置--require和--bail,官方文档是这样说的：\r\n\u003e\r\n\u003e–require\r\n\u003e\r\n\u003eThe –require option is useful for libraries such as should.js, so you may simply –require should instead of manually invoking require(‘should’) within each test file.\r\n\u003e\r\n\u003e意思是--require和在代码里手动require('babel-register')一样，但写在配置里会作用到每个test文件。默认支持.es .js .jsx扩展名. 老版本的Mocha使用--compilers命令支持其他文件扩展名，但在4.0后就废弃掉了。\r\n\u003e\r\n\u003e–bail\r\n\u003e\r\n\u003eOnly interested in the first exception? use –bail!\r\n\u003e\r\n\u003e--bail可以在第一个异常抛出的时候停止运行测试,这对集成测试很重要。\r\n\u003e\r\n\u003eAbout Babel\r\n\u003e\r\n\u003eIf your ES6 modules have extension .js, you can npm install –save-dev babel-register and use mocha –require babel-register; –compilers is only necessary if you need to specify a file extension.\r\n\u003e\r\n\u003ebabel-register可以让Mocha支持ES6 module，就是import export 写法.\r\n\u003e\r\n\u003ebabel-preset-env在没有任何配置选项的情况下，与 babel-preset-latest（或者babel-preset-es2015，babel-preset-es2016和babel-preset-es2017一起）的行为完全相同。官方推荐使用babel-preset-env.\r\n\r\n","comments":{"nodes":[]},"reactionGroups":[{"content":"THUMBS_UP","reactors":{"totalCount":0}},{"content":"THUMBS_DOWN","reactors":{"totalCount":0}},{"content":"LAUGH","reactors":{"totalCount":0}},{"content":"HOORAY","reactors":{"totalCount":0}},{"content":"CONFUSED","reactors":{"totalCount":0}},{"content":"HEART","reactors":{"totalCount":0}},{"content":"ROCKET","reactors":{"totalCount":0}},{"content":"EYES","reactors":{"totalCount":0}}],"author":{"login":"xiaotiandada","url":"https://github.com/xiaotiandada","avatarUrl":"https://avatars.githubusercontent.com/u/24250627?u=51a93e07957381123eb9fbdd6407de36033b578d\u0026v=4"},"html":"\u003cp\u003e2020-07-08 18:23:34\u003c/p\u003e\n\u003cp\u003e因为 Mocha 默认支持 commonJS\u003c/p\u003e\n\u003cp\u003e参考资料 \u003ca href=\"https://greenfavo.github.io/blog/docs/02.html\"\u003ehttps://greenfavo.github.io/blog/docs/02.html\u003c/a\u003e\u003c/p\u003e\n\u003c!-- more --\u003e\n\n\u003cp\u003e如果直接引入 import 会报错, 这让 写 es 语法的时候无法通过 import 来直接测试\u003c/p\u003e\n\u003cp\u003e这里借助 babel 转换\t\u003c/p\u003e\n\u003cp\u003e定义 \u003cstrong\u003escripts\u003c/strong\u003e 运行 \u003cstrong\u003etest\u003c/strong\u003e Mocha 会自动执行 test 目录的测试代码\u003c/p\u003e\n\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"token string-property property\"\u003e\"scripts\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token string-property property\"\u003e\"test\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"mocha\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e为了支持es6语法，加上以下代码\u003c/p\u003e\n\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"token string-property property\"\u003e\"scripts\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token string-property property\"\u003e\"test\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"mocha --require babel-register --bail\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e安装依赖\u003c/p\u003e\n\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003enpm install babel-register  babel-preset-env -D\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e新建 \u003cstrong\u003e.babelrc\u003c/strong\u003e \u003c/p\u003e\n\u003cpre class=\"language-json\"\u003e\u003ccode class=\"language-json\"\u003e{\n  \"presets\": [\n    [\"env\"]\n  ]\n}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003ebabel会自动读取\u003ccode\u003e.babelrc\u003c/code\u003e配置文件，这样就让我们的Mocha代码支持es6的模块系统和es6的其他语法了\u003c/p\u003e\n\u003cp\u003e运行\u003c/p\u003e\n\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003enpm run test\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eMocha配置说明 (纯复制\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eMocha的两个配置--require和--bail,官方文档是这样说的：\u003c/p\u003e\n\u003cp\u003e–require\u003c/p\u003e\n\u003cp\u003eThe –require option is useful for libraries such as should.js, so you may simply –require should instead of manually invoking require(‘should’) within each test file.\u003c/p\u003e\n\u003cp\u003e意思是--require和在代码里手动require(\u0026#39;babel-register\u0026#39;)一样，但写在配置里会作用到每个test文件。默认支持.es .js .jsx扩展名. 老版本的Mocha使用--compilers命令支持其他文件扩展名，但在4.0后就废弃掉了。\u003c/p\u003e\n\u003cp\u003e–bail\u003c/p\u003e\n\u003cp\u003eOnly interested in the first exception? use –bail!\u003c/p\u003e\n\u003cp\u003e--bail可以在第一个异常抛出的时候停止运行测试,这对集成测试很重要。\u003c/p\u003e\n\u003cp\u003eAbout Babel\u003c/p\u003e\n\u003cp\u003eIf your ES6 modules have extension .js, you can npm install –save-dev babel-register and use mocha –require babel-register; –compilers is only necessary if you need to specify a file extension.\u003c/p\u003e\n\u003cp\u003ebabel-register可以让Mocha支持ES6 module，就是import export 写法.\u003c/p\u003e\n\u003cp\u003ebabel-preset-env在没有任何配置选项的情况下，与 babel-preset-latest（或者babel-preset-es2015，babel-preset-es2016和babel-preset-es2017一起）的行为完全相同。官方推荐使用babel-preset-env.\u003c/p\u003e\n\u003c/blockquote\u003e\n","attributes":{}},"themeConfig":{"title":"Blog(issues)","links":[{"title":"GitHub","url":"https://github.com/xiaotiandada/blog"},{"title":"Twitter","url":"https://twitter.com/XiaoTianIsMe"}]}},"__N_SSG":true},"page":"/[...path]","query":{"path":["MDU6SXNzdWU3ODg3NTAyMjE="]},"buildId":"YPEk3V-eoVeml18YoUSCM","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>