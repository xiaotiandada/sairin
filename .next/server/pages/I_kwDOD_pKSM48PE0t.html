<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>React Native 学习 - Blog(issues)</title><meta property="og:type" content="artical"/><meta property="og:title" content="React Native 学习"/><meta property="og:image" content="
        https://og-image.vercel.app/React Native 学习.png?theme=light&amp;md=1&amp;fontSize=100px&amp;images=https%3A%2F%2Fassets.vercel.com%2Fimage%2Fupload%2Ffront%2Fassets%2Fdesign%2Fvercel-triangle-black.svg
      "/><meta property="article:published_time" content="2021-09-29T07:17:25Z"/><meta property="article:author" content="xiaotiandada"/><meta name="twitter:card" content="React Native 学习"/><meta name="twitter:title" content="React Native 学习"/><meta name="twitter:image" content="
        https://og-image.vercel.app/React Native 学习.png?theme=light&amp;md=1&amp;fontSize=100px&amp;images=https%3A%2F%2Fassets.vercel.com%2Fimage%2Fupload%2Ffront%2Fassets%2Fdesign%2Fvercel-triangle-black.svg
      "/><meta name="next-head-count" content="4"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin=""/><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Serif:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&amp;display=swap" rel="stylesheet"/><link rel="preload" href="/_next/static/css/b78bfc7021c6877d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b78bfc7021c6877d.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-cb7634a8b6194820.js" defer=""></script><script src="/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="/_next/static/chunks/main-2190439a97dca295.js" defer=""></script><script src="/_next/static/chunks/pages/_app-2aac380799256b7f.js" defer=""></script><script src="/_next/static/chunks/pages/%5B...path%5D-e0b96643230aac68.js" defer=""></script><script src="/_next/static/YPEk3V-eoVeml18YoUSCM/_buildManifest.js" defer=""></script><script src="/_next/static/YPEk3V-eoVeml18YoUSCM/_ssgManifest.js" defer=""></script><script src="/_next/static/YPEk3V-eoVeml18YoUSCM/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div><div class="container mx-auto mt-24 max-w-2xl px-4 sm:px-0"><div><div class="flex my-8 font-bold"><a href="/">Blog(issues)</a></div></div><div class="mb-8"><div class="text-3xl font-medium">React Native 学习</div><div class="flex mt-4 items-center gap-2"><img class="w-8 h-8 rounded-full" src="https://avatars.githubusercontent.com/u/24250627?u=51a93e07957381123eb9fbdd6407de36033b578d&amp;v=4"/><a target="_blank" href="https://github.com/xiaotiandada">xiaotiandada</a><a class="underline text-sm" target="_blank" href="https://github.com/xiaotiandada/blog/issues/86">View on GitHub</a></div><div class="my-8"><div class="flex gap-4 flex-wrap"></div></div></div><div class="post-body"><ul>
<li><a href="https://github.com/xiaotiandada/look">repo</a></li>
<li><a href="https://expo.dev/@xiaotiandada/AwesomeProject">App</a></li>
<li><a href="https://nativebase.io/">NativeBase</a> UI 组件库</li>
</ul>
<p>记录一些觉得有意义的功能点</p>
<h3 id="列表滚动">列表滚动</h3>
<ul>
<li><p>静态列表 不多的情况我会用 <a href="https://reactnative.dev/docs/scrollview">ScrollView</a></p>
<pre class="language-tsx"><code class="language-tsx"><ScrollView style={styles.scrollView}>
  <Text style={styles.text}>
    Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do
    eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad
    minim veniam, quis nostrud exercitation ullamco laboris nisi ut
    aliquip ex ea commodo consequat. Duis aute irure dolor in
    reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla
    pariatur. Excepteur sint occaecat cupidatat non proident, sunt in
    culpa qui officia deserunt mollit anim id est laborum.
  </Text>
</ScrollView></code></pre></li>
<li><p>动态加载 包含图片什么的 <a href="https://reactnative.dev/docs/flatlist">flatlist</a></p>
</li>
</ul>
<pre class="language-tsx"><code class="language-tsx"><FlatList
  data={DATA}
  renderItem={renderItem}
  keyExtractor={(item) => item.id}
  /></code></pre><ul>
<li><a href="https://reactnative.dev/docs/sectionlist">SectionList</a> 暂没用上</li>
</ul>
<h3 id="列表下拉刷新">列表下拉刷新</h3>
<pre class="language-tsx"><code class="language-tsx">const [refreshing, setRefreshing] = useState<boolean>(false);

// refresh
const onRefresh = useCallback(
  async () => {
    // do something
  }, []);


<FlatList
  ref={refFlatList}
  numColumns={2}
  renderItem={renderItem}
  keyExtractor={(item) => item.id}
  refreshControl={
    <RefreshControl refreshing={refreshing} onRefresh={onRefresh} />
  }
// ...</code></pre><p>FlatList 继承了 ScrollView 所以 ScrollView 也一样</p>
<h3 id="列表上拉加载">列表上拉加载</h3>
<pre class="language-tsx"><code class="language-tsx">// more load components
const RenderLoadMoreView = () => {
  return <View style={styles.loadMore}>
    <ActivityIndicator
      style={styles.indicator}
      size={"small"}
      animating={true}
      />
    <Text>Loading...</Text>
  </View>
};

const fetchCosplayMore = useCallback(
  async () => {
    // do something
  }, []);


<FlatList
  ref={refFlatList}
  numColumns={2}
  renderItem={renderItem}
  keyExtractor={(item) => item.id}
  refreshControl={
    <RefreshControl refreshing={refreshing} onRefresh={onRefresh} />
  }
  ListFooterComponent={() => RenderLoadMoreView()}
  onEndReached={() => fetchCosplayMore()}
  
  // ...</code></pre><h3 id="列表滚动-1">列表滚动</h3>
<pre class="language-tsx"><code class="language-tsx">const handleScroll = useCallback((e: NativeSyntheticEvent<NativeScrollEvent>) => {
  // do something
}, []);

<FlatList
  ref={refFlatList}
  numColumns={2}
  renderItem={renderItem}
  keyExtractor={(item) => item.id}
  refreshControl={
    <RefreshControl refreshing={refreshing} onRefresh={onRefresh} />
  }
  ListFooterComponent={() => RenderLoadMoreView()}
  onEndReached={() => fetchCosplayMore()}
  onScroll={handleScroll}</code></pre><h3 id="图片保存-ios">图片保存 ios</h3>
<pre class="language-tsx"><code class="language-tsx">import * as MediaLibrary from 'expo-media-library';
import * as ImagePicker from 'expo-image-picker';

const handleDownload = useCallback(
    async (url: string): Promise<void> => {
      // libraryPermissionResult Object {
      //   "accessPrivileges": "none",
      //   "canAskAgain": false,
      //   "expires": "never",
      //   "granted": false,
      //   "status": "denied",
      // }
    
      // copy doc 不太需要
      if (Platform.OS !== 'web') {
        const { status } = await ImagePicker.getMediaLibraryPermissionsAsync();
        if (status !== 'granted') {
          // Alert.alert('Sorry, we need media library permissions to make this work!');
          // return
        }
      } else {
        console.log('no support web')
        return
      }
            
      // 好像是这个权限 后来不知道怎么清空权限重新获取一下
      const libraryPermissionResult = await ImagePicker.getMediaLibraryPermissionsAsync()
      console.log('libraryPermissionResult', libraryPermissionResult)
      // ImagePicker.requestMediaLibraryPermissionsAsync(writeOnly)

      // Get permission
      if (libraryPermissionResult.accessPrivileges === 'none' && libraryPermissionResult.status !== 'granted') {
        await ImagePicker.requestMediaLibraryPermissionsAsync(true)

        const _libraryPermissionResult = await ImagePicker.getMediaLibraryPermissionsAsync()
        console.log('_libraryPermissionResult', _libraryPermissionResult)

        if (_libraryPermissionResult.accessPrivileges === 'none' && _libraryPermissionResult.status !== 'granted') {
          return
        }
      }

      // Save
      try {
        // encode 因为图片 url 有中文 会报错
        await MediaLibrary.saveToLibraryAsync(encodeURI(url))
        Alert.alert('Saved successfully')

      } catch (error) {
        console.log('error', error)
        Alert.alert('Save failed')
      }
    }, [])</code></pre><blockquote>
<p>先跑了个流程</p>
</blockquote>
<h3 id="actionsheetios">ActionSheetIOS</h3>
<pre class="language-tsx"><code class="language-tsx">import { ActionSheetIOS } from 'react-native';

const onPress = () =>
  ActionSheetIOS.showActionSheetWithOptions(
    {
      options: ["Cancel", "Generate number", "Reset"],
      destructiveButtonIndex: 2,
      cancelButtonIndex: 0,
      userInterfaceStyle: 'dark'
    },
    buttonIndex => {
      if (buttonIndex === 0) {
        // cancel action
      } else if (buttonIndex === 1) {
        setResult(Math.floor(Math.random() * 100) + 1);
      } else if (buttonIndex === 2) {
        setResult("🔮");
      }
    }
  );</code></pre><p>会弹出一个菜单</p>
<h3 id="share">Share</h3>
<pre class="language-tsx"><code class="language-tsx">import { Share } from 'react-native';
const onShare = async () => {
    try {
      const result = await Share.share({
        message:
          'React Native | A framework for building native apps using React',
      });
      if (result.action === Share.sharedAction) {
        if (result.activityType) {
          // shared with activity type of result.activityType
        } else {
          // shared
        }
      } else if (result.action === Share.dismissedAction) {
        // dismissed
      }
    } catch (error) {
      alert(error.message);
    }
  };</code></pre><p>会出现一个 分享 菜单，和 expo share sdk 有什么区别我还不知道 <a href="https://docs.expo.dev/versions/latest/react-native/share/">https://docs.expo.dev/versions/latest/react-native/share/</a></p>
<h3 id="返回到顶部">返回到顶部</h3>
<pre class="language-tsx"><code class="language-tsx">// TODO: type fix
const refFlatList = useRef<any>(null);

// go top
const goToTop = useCallback(() => {
  // 后来看见的 懒得试
  // https://reactnavigation.org/docs/use-scroll-to-top
  refFlatList.current.scrollToOffset({ offset: 0 });
}, [refFlatList]);


<FlatList
  ref={refFlatList}</code></pre><p>reactnavigation 文档也提到了这个功能</p>
<h3 id="react-navigation">react-navigation</h3>
<p><a href="https://reactnavigation.org/">https://reactnavigation.org/</a></p>
<ul>
<li><p>navigation.navigate(&#39;Detail&#39;) 只会产生一条记录</p>
</li>
<li><p>navigation.push(&#39;Detail&#39;) 会产出N条记录</p>
</li>
<li><p>useFocusEffect</p>
<pre class="language-tsx"><code class="language-tsx">useFocusEffect(
  useCallback(() => {
    const fetch = () => something()
    fetch()
  }, [])
);</code></pre></li>
<li><p>params <code>navigation.navigate(&#39;Detail&#39;, params)</code></p>
</li>
<li><p>...</p>
</li>
</ul>
<h3 id="背景渐变">背景渐变</h3>
<pre class="language-tsx"><code class="language-tsx">import * as React from 'react';
import { StyleSheet, Text, View } from 'react-native';
import { LinearGradient } from 'expo-linear-gradient';

export default function App() {
  return (
    <View style={styles.container}>
      <LinearGradient
        // Background Linear Gradient
        colors={['rgba(0,0,0,0.8)', 'transparent']}
        style={styles.background}
      />
      <LinearGradient
        // Button Linear Gradient
        colors={['#4c669f', '#3b5998', '#192f6a']}
        style={styles.button}>
        <Text style={styles.text}>Sign in with Facebook</Text>
      </LinearGradient>
    </View>
  );
}

const styles = StyleSheet.create({ ... }); </code></pre></div><hr class="my-12"/><div class="font-sans"><div class="mb-12"><a target="_blank" href="https://github.com/xiaotiandada/blog/issues/86" class="font-medium border border-gray-700 hover:bg-gray-700 hover:text-gray-100 transition-all text-gray-700 text-sm rounded px-4 py-2">Add comment</a></div></div><div class="my-12"><div class="text-sm">Powered by <a class="underline" target="_blank" href="https://github.com/djyde/sairin">Sairin</a></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"id":"I_kwDOD_pKSM48PE0t","url":"https://github.com/xiaotiandada/blog/issues/86","title":"React Native 学习","updatedAt":"2021-09-29T08:17:55Z","createdAt":"2021-09-29T07:17:25Z","body":"- [repo](https://github.com/xiaotiandada/look)\r\n- [App](https://expo.dev/@xiaotiandada/AwesomeProject)\r\n- [NativeBase](https://nativebase.io/) UI 组件库\r\n\r\n记录一些觉得有意义的功能点\r\n\r\n### 列表滚动\r\n\r\n- 静态列表 不多的情况我会用 [ScrollView](https://reactnative.dev/docs/scrollview)\r\n\r\n  ```tsx\r\n  \u003cScrollView style={styles.scrollView}\u003e\r\n    \u003cText style={styles.text}\u003e\r\n      Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do\r\n      eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad\r\n      minim veniam, quis nostrud exercitation ullamco laboris nisi ut\r\n      aliquip ex ea commodo consequat. Duis aute irure dolor in\r\n      reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla\r\n      pariatur. Excepteur sint occaecat cupidatat non proident, sunt in\r\n      culpa qui officia deserunt mollit anim id est laborum.\r\n    \u003c/Text\u003e\r\n  \u003c/ScrollView\u003e\r\n  ```\r\n\r\n- 动态加载 包含图片什么的 [flatlist](https://reactnative.dev/docs/flatlist)\r\n\r\n```tsx\r\n\u003cFlatList\r\n  data={DATA}\r\n  renderItem={renderItem}\r\n  keyExtractor={(item) =\u003e item.id}\r\n  /\u003e\r\n```\r\n\r\n- [SectionList](https://reactnative.dev/docs/sectionlist) 暂没用上\r\n\r\n### 列表下拉刷新\r\n\r\n```tsx\r\nconst [refreshing, setRefreshing] = useState\u003cboolean\u003e(false);\r\n\r\n// refresh\r\nconst onRefresh = useCallback(\r\n  async () =\u003e {\r\n    // do something\r\n  }, []);\r\n\r\n\r\n\u003cFlatList\r\n  ref={refFlatList}\r\n  numColumns={2}\r\n  renderItem={renderItem}\r\n  keyExtractor={(item) =\u003e item.id}\r\n  refreshControl={\r\n    \u003cRefreshControl refreshing={refreshing} onRefresh={onRefresh} /\u003e\r\n  }\r\n// ...\r\n```\r\n\r\nFlatList 继承了 ScrollView 所以 ScrollView 也一样\r\n\r\n\r\n\r\n### 列表上拉加载\r\n\r\n```tsx\r\n// more load components\r\nconst RenderLoadMoreView = () =\u003e {\r\n  return \u003cView style={styles.loadMore}\u003e\r\n    \u003cActivityIndicator\r\n      style={styles.indicator}\r\n      size={\"small\"}\r\n      animating={true}\r\n      /\u003e\r\n    \u003cText\u003eLoading...\u003c/Text\u003e\r\n  \u003c/View\u003e\r\n};\r\n\r\nconst fetchCosplayMore = useCallback(\r\n  async () =\u003e {\r\n    // do something\r\n  }, []);\r\n\r\n\r\n\u003cFlatList\r\n  ref={refFlatList}\r\n  numColumns={2}\r\n  renderItem={renderItem}\r\n  keyExtractor={(item) =\u003e item.id}\r\n  refreshControl={\r\n    \u003cRefreshControl refreshing={refreshing} onRefresh={onRefresh} /\u003e\r\n  }\r\n  ListFooterComponent={() =\u003e RenderLoadMoreView()}\r\n  onEndReached={() =\u003e fetchCosplayMore()}\r\n  \r\n  // ...\r\n```\r\n\r\n\r\n\r\n### 列表滚动\r\n\r\n```tsx\r\nconst handleScroll = useCallback((e: NativeSyntheticEvent\u003cNativeScrollEvent\u003e) =\u003e {\r\n  // do something\r\n}, []);\r\n\r\n\u003cFlatList\r\n  ref={refFlatList}\r\n  numColumns={2}\r\n  renderItem={renderItem}\r\n  keyExtractor={(item) =\u003e item.id}\r\n  refreshControl={\r\n    \u003cRefreshControl refreshing={refreshing} onRefresh={onRefresh} /\u003e\r\n  }\r\n  ListFooterComponent={() =\u003e RenderLoadMoreView()}\r\n  onEndReached={() =\u003e fetchCosplayMore()}\r\n  onScroll={handleScroll}\r\n```\r\n\r\n\r\n\r\n### 图片保存 ios\r\n\r\n```tsx\r\nimport * as MediaLibrary from 'expo-media-library';\r\nimport * as ImagePicker from 'expo-image-picker';\r\n\r\nconst handleDownload = useCallback(\r\n    async (url: string): Promise\u003cvoid\u003e =\u003e {\r\n      // libraryPermissionResult Object {\r\n      //   \"accessPrivileges\": \"none\",\r\n      //   \"canAskAgain\": false,\r\n      //   \"expires\": \"never\",\r\n      //   \"granted\": false,\r\n      //   \"status\": \"denied\",\r\n      // }\r\n\t\r\n      // copy doc 不太需要\r\n      if (Platform.OS !== 'web') {\r\n        const { status } = await ImagePicker.getMediaLibraryPermissionsAsync();\r\n        if (status !== 'granted') {\r\n          // Alert.alert('Sorry, we need media library permissions to make this work!');\r\n          // return\r\n        }\r\n      } else {\r\n        console.log('no support web')\r\n        return\r\n      }\r\n\t\t\t\r\n      // 好像是这个权限 后来不知道怎么清空权限重新获取一下\r\n      const libraryPermissionResult = await ImagePicker.getMediaLibraryPermissionsAsync()\r\n      console.log('libraryPermissionResult', libraryPermissionResult)\r\n      // ImagePicker.requestMediaLibraryPermissionsAsync(writeOnly)\r\n\r\n      // Get permission\r\n      if (libraryPermissionResult.accessPrivileges === 'none' \u0026\u0026 libraryPermissionResult.status !== 'granted') {\r\n        await ImagePicker.requestMediaLibraryPermissionsAsync(true)\r\n\r\n        const _libraryPermissionResult = await ImagePicker.getMediaLibraryPermissionsAsync()\r\n        console.log('_libraryPermissionResult', _libraryPermissionResult)\r\n\r\n        if (_libraryPermissionResult.accessPrivileges === 'none' \u0026\u0026 _libraryPermissionResult.status !== 'granted') {\r\n          return\r\n        }\r\n      }\r\n\r\n      // Save\r\n      try {\r\n        // encode 因为图片 url 有中文 会报错\r\n        await MediaLibrary.saveToLibraryAsync(encodeURI(url))\r\n        Alert.alert('Saved successfully')\r\n\r\n      } catch (error) {\r\n        console.log('error', error)\r\n        Alert.alert('Save failed')\r\n      }\r\n    }, [])\r\n```\r\n\r\n\u003e 先跑了个流程\r\n\r\n### ActionSheetIOS\r\n\r\n```tsx\r\nimport { ActionSheetIOS } from 'react-native';\r\n\r\nconst onPress = () =\u003e\r\n  ActionSheetIOS.showActionSheetWithOptions(\r\n    {\r\n      options: [\"Cancel\", \"Generate number\", \"Reset\"],\r\n      destructiveButtonIndex: 2,\r\n      cancelButtonIndex: 0,\r\n      userInterfaceStyle: 'dark'\r\n    },\r\n    buttonIndex =\u003e {\r\n      if (buttonIndex === 0) {\r\n        // cancel action\r\n      } else if (buttonIndex === 1) {\r\n        setResult(Math.floor(Math.random() * 100) + 1);\r\n      } else if (buttonIndex === 2) {\r\n        setResult(\"🔮\");\r\n      }\r\n    }\r\n  );\r\n```\r\n\r\n会弹出一个菜单\r\n\r\n\r\n\r\n### Share\r\n\r\n```tsx\r\nimport { Share } from 'react-native';\r\nconst onShare = async () =\u003e {\r\n    try {\r\n      const result = await Share.share({\r\n        message:\r\n          'React Native | A framework for building native apps using React',\r\n      });\r\n      if (result.action === Share.sharedAction) {\r\n        if (result.activityType) {\r\n          // shared with activity type of result.activityType\r\n        } else {\r\n          // shared\r\n        }\r\n      } else if (result.action === Share.dismissedAction) {\r\n        // dismissed\r\n      }\r\n    } catch (error) {\r\n      alert(error.message);\r\n    }\r\n  };\r\n```\r\n\r\n会出现一个 分享 菜单，和 expo share sdk 有什么区别我还不知道 https://docs.expo.dev/versions/latest/react-native/share/\r\n\r\n### 返回到顶部\r\n\r\n```tsx\r\n// TODO: type fix\r\nconst refFlatList = useRef\u003cany\u003e(null);\r\n\r\n// go top\r\nconst goToTop = useCallback(() =\u003e {\r\n  // 后来看见的 懒得试\r\n  // https://reactnavigation.org/docs/use-scroll-to-top\r\n  refFlatList.current.scrollToOffset({ offset: 0 });\r\n}, [refFlatList]);\r\n\r\n\r\n\u003cFlatList\r\n  ref={refFlatList}\r\n```\r\n\r\nreactnavigation 文档也提到了这个功能\r\n\r\n### react-navigation\r\n\r\nhttps://reactnavigation.org/\r\n\r\n- navigation.navigate('Detail') 只会产生一条记录\r\n\r\n- navigation.push('Detail') 会产出N条记录\r\n\r\n- useFocusEffect\r\n\r\n  ```tsx\r\n  useFocusEffect(\r\n    useCallback(() =\u003e {\r\n      const fetch = () =\u003e something()\r\n      fetch()\r\n    }, [])\r\n  );\r\n  ```\r\n\r\n- params ``navigation.navigate('Detail', params)``\r\n- ...\r\n\r\n### 背景渐变\r\n\r\n```tsx\r\nimport * as React from 'react';\r\nimport { StyleSheet, Text, View } from 'react-native';\r\nimport { LinearGradient } from 'expo-linear-gradient';\r\n\r\nexport default function App() {\r\n  return (\r\n    \u003cView style={styles.container}\u003e\r\n      \u003cLinearGradient\r\n        // Background Linear Gradient\r\n        colors={['rgba(0,0,0,0.8)', 'transparent']}\r\n        style={styles.background}\r\n      /\u003e\r\n      \u003cLinearGradient\r\n        // Button Linear Gradient\r\n        colors={['#4c669f', '#3b5998', '#192f6a']}\r\n        style={styles.button}\u003e\r\n        \u003cText style={styles.text}\u003eSign in with Facebook\u003c/Text\u003e\r\n      \u003c/LinearGradient\u003e\r\n    \u003c/View\u003e\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({ ... }); \r\n```\r\n\r\n","comments":{"nodes":[]},"reactionGroups":[{"content":"THUMBS_UP","reactors":{"totalCount":0}},{"content":"THUMBS_DOWN","reactors":{"totalCount":0}},{"content":"LAUGH","reactors":{"totalCount":0}},{"content":"HOORAY","reactors":{"totalCount":0}},{"content":"CONFUSED","reactors":{"totalCount":0}},{"content":"HEART","reactors":{"totalCount":0}},{"content":"ROCKET","reactors":{"totalCount":0}},{"content":"EYES","reactors":{"totalCount":0}}],"author":{"login":"xiaotiandada","url":"https://github.com/xiaotiandada","avatarUrl":"https://avatars.githubusercontent.com/u/24250627?u=51a93e07957381123eb9fbdd6407de36033b578d\u0026v=4"},"html":"\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/xiaotiandada/look\"\u003erepo\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://expo.dev/@xiaotiandada/AwesomeProject\"\u003eApp\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://nativebase.io/\"\u003eNativeBase\u003c/a\u003e UI 组件库\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e记录一些觉得有意义的功能点\u003c/p\u003e\n\u003ch3 id=\"列表滚动\"\u003e列表滚动\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003e静态列表 不多的情况我会用 \u003ca href=\"https://reactnative.dev/docs/scrollview\"\u003eScrollView\u003c/a\u003e\u003c/p\u003e\n\u003cpre class=\"language-tsx\"\u003e\u003ccode class=\"language-tsx\"\u003e\u003cScrollView style={styles.scrollView}\u003e\n  \u003cText style={styles.text}\u003e\n    Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do\n    eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad\n    minim veniam, quis nostrud exercitation ullamco laboris nisi ut\n    aliquip ex ea commodo consequat. Duis aute irure dolor in\n    reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla\n    pariatur. Excepteur sint occaecat cupidatat non proident, sunt in\n    culpa qui officia deserunt mollit anim id est laborum.\n  \u003c/Text\u003e\n\u003c/ScrollView\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e动态加载 包含图片什么的 \u003ca href=\"https://reactnative.dev/docs/flatlist\"\u003eflatlist\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre class=\"language-tsx\"\u003e\u003ccode class=\"language-tsx\"\u003e\u003cFlatList\n  data={DATA}\n  renderItem={renderItem}\n  keyExtractor={(item) =\u003e item.id}\n  /\u003e\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://reactnative.dev/docs/sectionlist\"\u003eSectionList\u003c/a\u003e 暂没用上\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"列表下拉刷新\"\u003e列表下拉刷新\u003c/h3\u003e\n\u003cpre class=\"language-tsx\"\u003e\u003ccode class=\"language-tsx\"\u003econst [refreshing, setRefreshing] = useState\u003cboolean\u003e(false);\n\n// refresh\nconst onRefresh = useCallback(\n  async () =\u003e {\n    // do something\n  }, []);\n\n\n\u003cFlatList\n  ref={refFlatList}\n  numColumns={2}\n  renderItem={renderItem}\n  keyExtractor={(item) =\u003e item.id}\n  refreshControl={\n    \u003cRefreshControl refreshing={refreshing} onRefresh={onRefresh} /\u003e\n  }\n// ...\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eFlatList 继承了 ScrollView 所以 ScrollView 也一样\u003c/p\u003e\n\u003ch3 id=\"列表上拉加载\"\u003e列表上拉加载\u003c/h3\u003e\n\u003cpre class=\"language-tsx\"\u003e\u003ccode class=\"language-tsx\"\u003e// more load components\nconst RenderLoadMoreView = () =\u003e {\n  return \u003cView style={styles.loadMore}\u003e\n    \u003cActivityIndicator\n      style={styles.indicator}\n      size={\"small\"}\n      animating={true}\n      /\u003e\n    \u003cText\u003eLoading...\u003c/Text\u003e\n  \u003c/View\u003e\n};\n\nconst fetchCosplayMore = useCallback(\n  async () =\u003e {\n    // do something\n  }, []);\n\n\n\u003cFlatList\n  ref={refFlatList}\n  numColumns={2}\n  renderItem={renderItem}\n  keyExtractor={(item) =\u003e item.id}\n  refreshControl={\n    \u003cRefreshControl refreshing={refreshing} onRefresh={onRefresh} /\u003e\n  }\n  ListFooterComponent={() =\u003e RenderLoadMoreView()}\n  onEndReached={() =\u003e fetchCosplayMore()}\n  \n  // ...\u003c/code\u003e\u003c/pre\u003e\u003ch3 id=\"列表滚动-1\"\u003e列表滚动\u003c/h3\u003e\n\u003cpre class=\"language-tsx\"\u003e\u003ccode class=\"language-tsx\"\u003econst handleScroll = useCallback((e: NativeSyntheticEvent\u003cNativeScrollEvent\u003e) =\u003e {\n  // do something\n}, []);\n\n\u003cFlatList\n  ref={refFlatList}\n  numColumns={2}\n  renderItem={renderItem}\n  keyExtractor={(item) =\u003e item.id}\n  refreshControl={\n    \u003cRefreshControl refreshing={refreshing} onRefresh={onRefresh} /\u003e\n  }\n  ListFooterComponent={() =\u003e RenderLoadMoreView()}\n  onEndReached={() =\u003e fetchCosplayMore()}\n  onScroll={handleScroll}\u003c/code\u003e\u003c/pre\u003e\u003ch3 id=\"图片保存-ios\"\u003e图片保存 ios\u003c/h3\u003e\n\u003cpre class=\"language-tsx\"\u003e\u003ccode class=\"language-tsx\"\u003eimport * as MediaLibrary from 'expo-media-library';\nimport * as ImagePicker from 'expo-image-picker';\n\nconst handleDownload = useCallback(\n    async (url: string): Promise\u003cvoid\u003e =\u003e {\n      // libraryPermissionResult Object {\n      //   \"accessPrivileges\": \"none\",\n      //   \"canAskAgain\": false,\n      //   \"expires\": \"never\",\n      //   \"granted\": false,\n      //   \"status\": \"denied\",\n      // }\n    \n      // copy doc 不太需要\n      if (Platform.OS !== 'web') {\n        const { status } = await ImagePicker.getMediaLibraryPermissionsAsync();\n        if (status !== 'granted') {\n          // Alert.alert('Sorry, we need media library permissions to make this work!');\n          // return\n        }\n      } else {\n        console.log('no support web')\n        return\n      }\n            \n      // 好像是这个权限 后来不知道怎么清空权限重新获取一下\n      const libraryPermissionResult = await ImagePicker.getMediaLibraryPermissionsAsync()\n      console.log('libraryPermissionResult', libraryPermissionResult)\n      // ImagePicker.requestMediaLibraryPermissionsAsync(writeOnly)\n\n      // Get permission\n      if (libraryPermissionResult.accessPrivileges === 'none' \u0026\u0026 libraryPermissionResult.status !== 'granted') {\n        await ImagePicker.requestMediaLibraryPermissionsAsync(true)\n\n        const _libraryPermissionResult = await ImagePicker.getMediaLibraryPermissionsAsync()\n        console.log('_libraryPermissionResult', _libraryPermissionResult)\n\n        if (_libraryPermissionResult.accessPrivileges === 'none' \u0026\u0026 _libraryPermissionResult.status !== 'granted') {\n          return\n        }\n      }\n\n      // Save\n      try {\n        // encode 因为图片 url 有中文 会报错\n        await MediaLibrary.saveToLibraryAsync(encodeURI(url))\n        Alert.alert('Saved successfully')\n\n      } catch (error) {\n        console.log('error', error)\n        Alert.alert('Save failed')\n      }\n    }, [])\u003c/code\u003e\u003c/pre\u003e\u003cblockquote\u003e\n\u003cp\u003e先跑了个流程\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 id=\"actionsheetios\"\u003eActionSheetIOS\u003c/h3\u003e\n\u003cpre class=\"language-tsx\"\u003e\u003ccode class=\"language-tsx\"\u003eimport { ActionSheetIOS } from 'react-native';\n\nconst onPress = () =\u003e\n  ActionSheetIOS.showActionSheetWithOptions(\n    {\n      options: [\"Cancel\", \"Generate number\", \"Reset\"],\n      destructiveButtonIndex: 2,\n      cancelButtonIndex: 0,\n      userInterfaceStyle: 'dark'\n    },\n    buttonIndex =\u003e {\n      if (buttonIndex === 0) {\n        // cancel action\n      } else if (buttonIndex === 1) {\n        setResult(Math.floor(Math.random() * 100) + 1);\n      } else if (buttonIndex === 2) {\n        setResult(\"🔮\");\n      }\n    }\n  );\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e会弹出一个菜单\u003c/p\u003e\n\u003ch3 id=\"share\"\u003eShare\u003c/h3\u003e\n\u003cpre class=\"language-tsx\"\u003e\u003ccode class=\"language-tsx\"\u003eimport { Share } from 'react-native';\nconst onShare = async () =\u003e {\n    try {\n      const result = await Share.share({\n        message:\n          'React Native | A framework for building native apps using React',\n      });\n      if (result.action === Share.sharedAction) {\n        if (result.activityType) {\n          // shared with activity type of result.activityType\n        } else {\n          // shared\n        }\n      } else if (result.action === Share.dismissedAction) {\n        // dismissed\n      }\n    } catch (error) {\n      alert(error.message);\n    }\n  };\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e会出现一个 分享 菜单，和 expo share sdk 有什么区别我还不知道 \u003ca href=\"https://docs.expo.dev/versions/latest/react-native/share/\"\u003ehttps://docs.expo.dev/versions/latest/react-native/share/\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"返回到顶部\"\u003e返回到顶部\u003c/h3\u003e\n\u003cpre class=\"language-tsx\"\u003e\u003ccode class=\"language-tsx\"\u003e// TODO: type fix\nconst refFlatList = useRef\u003cany\u003e(null);\n\n// go top\nconst goToTop = useCallback(() =\u003e {\n  // 后来看见的 懒得试\n  // https://reactnavigation.org/docs/use-scroll-to-top\n  refFlatList.current.scrollToOffset({ offset: 0 });\n}, [refFlatList]);\n\n\n\u003cFlatList\n  ref={refFlatList}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003ereactnavigation 文档也提到了这个功能\u003c/p\u003e\n\u003ch3 id=\"react-navigation\"\u003ereact-navigation\u003c/h3\u003e\n\u003cp\u003e\u003ca href=\"https://reactnavigation.org/\"\u003ehttps://reactnavigation.org/\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003enavigation.navigate(\u0026#39;Detail\u0026#39;) 只会产生一条记录\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003enavigation.push(\u0026#39;Detail\u0026#39;) 会产出N条记录\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003euseFocusEffect\u003c/p\u003e\n\u003cpre class=\"language-tsx\"\u003e\u003ccode class=\"language-tsx\"\u003euseFocusEffect(\n  useCallback(() =\u003e {\n    const fetch = () =\u003e something()\n    fetch()\n  }, [])\n);\u003c/code\u003e\u003c/pre\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eparams \u003ccode\u003enavigation.navigate(\u0026#39;Detail\u0026#39;, params)\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e...\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"背景渐变\"\u003e背景渐变\u003c/h3\u003e\n\u003cpre class=\"language-tsx\"\u003e\u003ccode class=\"language-tsx\"\u003eimport * as React from 'react';\nimport { StyleSheet, Text, View } from 'react-native';\nimport { LinearGradient } from 'expo-linear-gradient';\n\nexport default function App() {\n  return (\n    \u003cView style={styles.container}\u003e\n      \u003cLinearGradient\n        // Background Linear Gradient\n        colors={['rgba(0,0,0,0.8)', 'transparent']}\n        style={styles.background}\n      /\u003e\n      \u003cLinearGradient\n        // Button Linear Gradient\n        colors={['#4c669f', '#3b5998', '#192f6a']}\n        style={styles.button}\u003e\n        \u003cText style={styles.text}\u003eSign in with Facebook\u003c/Text\u003e\n      \u003c/LinearGradient\u003e\n    \u003c/View\u003e\n  );\n}\n\nconst styles = StyleSheet.create({ ... }); \u003c/code\u003e\u003c/pre\u003e","attributes":{}},"themeConfig":{"title":"Blog(issues)","links":[{"title":"GitHub","url":"https://github.com/xiaotiandada/blog"},{"title":"Twitter","url":"https://twitter.com/XiaoTianIsMe"}]}},"__N_SSG":true},"page":"/[...path]","query":{"path":["I_kwDOD_pKSM48PE0t"]},"buildId":"YPEk3V-eoVeml18YoUSCM","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>